{"version":3,"file":"example.es.js","sources":["../../node_modules/@meitu/mtouch/src/utils.js","../../node_modules/@meitu/mtouch/src/handlerBus.js","../../node_modules/@meitu/mtouch/src/index.js","../../node_modules/@meitu/mcanvas/src/utils.js","../../node_modules/@meitu/mcanvas/src/index.js","../../src/utils.js","../../src/zIndex.js","../../src/index.js","../index.js"],"sourcesContent":["export default {\n    getLength(v1) {\n        if (typeof v1 !== 'object') {\n            console.error('getLength error!');\n            return;\n        }\n        return Math.sqrt(v1.x * v1.x + v1.y * v1.y);\n    },\n    getAngle(v1, v2) {\n        if (typeof v1 !== 'object' || typeof v2 !== 'object') {\n            console.error('getAngle error!');\n            return;\n        }\n        // 判断方向，顺时针为 1 ,逆时针为 -1；\n        let direction = v1.x * v2.y - v2.x * v1.y > 0 ? 1: -1,\n            // 两个向量的模；\n            len1 = this.getLength(v1),\n            len2 = this.getLength(v2),\n            mr = len1 * len2,\n            dot,r;\n        if (mr === 0)return 0;\n        // 通过数量积公式可以推导出：\n        // cos = (x1 * x2 + y1 * y2)/(|a| * |b|);\n        dot = v1.x * v2.x + v1.y * v2.y;\n        r = dot / mr;\n        if (r > 1)r = 1;\n        if (r < -1)r = -1;\n        // 解值并结合方向转化为角度值；\n        return Math.acos(r) * direction * 180 / Math.PI;\n    },\n    getBasePoint(el) {\n        if (!el) return {x:0,y:0};\n        let offset = this.getOffset(el);\n        let x = offset.left + el.getBoundingClientRect().width / 2,\n            y = offset.top + el.getBoundingClientRect().width / 2;\n        return {x: Math.round(x), y: Math.round(y)};\n    },\n    extend(obj1, obj2) {\n        for (let k in obj2) {\n            if (obj2.hasOwnProperty(k)) {\n                if(typeof obj2[k] == 'object' && !(obj2[k] instanceof Node)){\n                    if(typeof obj1[k] !== 'object'){\n                        obj1[k] = {};\n                    }\n                    this.extend(obj1[k],obj2[k]);\n                }else{\n                    obj1[k] = obj2[k];\n                }\n            }\n        }\n        return obj1;\n    },\n    getVector(p1, p2) {\n        if (typeof p1 !== 'object' || typeof p2 !== 'object' ) {\n            console.error('getvector error!');\n            return;\n        }\n        let x = Math.round(p1.x - p2.x),\n            y = Math.round(p1.y - p2.y);\n        return { x, y };\n    },\n    getPoint(ev, index) {\n        if (!ev || !ev.touches[index]) {\n            console.error('getPoint error!');\n            return;\n        }\n        return {\n            x: Math.round(ev.touches[index].pageX),\n            y: Math.round(ev.touches[index].pageY),\n        };\n    },\n    getOffset(el){\n        el = typeof el == 'string'? document.querySelector(el): el;\n        let rect = el.getBoundingClientRect();\n        let offset = {\n            left:rect.left + document.body.scrollLeft,\n            top:rect.top + document.body.scrollTop,\n            width:el.offsetWidth,\n            height:el.offsetHeight,\n        };\n        return offset;\n    },\n    matrixTo(matrix){\n        let arr = (matrix.replace('matrix(','').replace(')','')).split(',');\n        let cos = arr[0],\n            sin = arr[1],\n            tan = sin / cos,\n            rotate = Math.atan( tan ) * 180 / Math.PI,\n            scale = cos / ( Math.cos( Math.PI / 180 * rotate )),\n            trans;\n        trans = {\n            x:parseInt(arr[4]),\n            y:parseInt(arr[5]),\n            scale,\n            rotate,\n        };\n        return trans;\n    },\n    getUseName(evName){\n        let useName = evName.replace('start','');\n        let end = useName.indexOf('rotate') !== -1 ? 'nd' : 'end';\n        useName = useName.replace(end,'');\n        return useName;\n    },\n    domify(DOMString) {\n        let htmlDoc = document.implementation.createHTMLDocument();\n        htmlDoc.body.innerHTML = DOMString;\n        return htmlDoc.body.children;\n    },\n    getEl(el){\n        if(!el){\n            console.error('el error,there must be a el!');\n            return;\n        }\n        let _el;\n        if(typeof el == 'string'){\n            _el = document.querySelector(el);\n        }else if(el instanceof Node){\n            _el = el;\n        }else{\n            console.error('el error,there must be a el!');\n            return;\n        }\n        return _el;\n    },\n    data(el,key){\n        el = this.getEl(el);\n        return el.getAttribute(`data-${key}`);\n    },\n    include(str1,str2){\n        if(str1.indexOf){\n            return str1.indexOf(str2) !== -1;\n        }else{\n            return false;\n        }\n    },\n    getPos(el) {\n        if(!el)return;\n        el = this.getEl(el);\n        let defaulTrans;\n        let style = window.getComputedStyle(el,null);\n        let cssTrans = style.transform || style.webkitTransform;\n\n        if(window.getComputedStyle && cssTrans !== 'none'){\n            defaulTrans = this.matrixTo(cssTrans);\n        }else{\n            defaulTrans = {\n                x: 0,\n                y: 0,\n                scale: 1,\n                rotate: 0,\n            };\n        }\n        return JSON.parse(el.getAttribute('data-mtouch-status')) || defaulTrans;\n    },\n};\n","export default class HandlerBus{\n    constructor(el) {\n        this.handlers = [];\n        this.el = el;\n    }\n    add(handler){\n        this.handlers.push(handler);\n        return this;\n    }\n    del(handler){\n        if(!handler){\n            this.handlers = [];\n        }else{\n            this.handlers.forEach((value,index)=>{\n                if(value === handler){\n                    this.handlers.splice(index,1);\n                }\n            });\n        }\n        return this;\n    }\n    fire(){\n        if(!this.handlers || !this.handlers.length === 0)return;\n        this.handlers.forEach(handler=>{\n            if(typeof handler === 'function') handler.apply(this.el, arguments);\n        });\n        return this;\n    }\n}\n","import _ from './utils';\nimport HandlerBus from './handlerBus';\n\nconst EVENT = ['touchstart','touchmove','touchend','drag','dragstart','dragend','pinch','pinchstart','pinchend','rotate','rotatestart','rotatend','singlePinchstart','singlePinch','singlePinchend','singleRotate','singleRotatestart','singleRotatend'];\n\nconst ORIGINEVENT = ['touchstart', 'touchmove', 'touchend', 'touchcancel'];\n\nexport default function MTouch(el = '') {\n    // 兼容不使用 new 的方式；\n    if (!(this instanceof MTouch))return new MTouch(el);\n    // 开关；\n    // 初始化时关闭，在调用 on 函数时对应开启；\n    this.use = {\n        drag: false,\n        pinch: false,\n        rotate: false,\n        singlePinch: false,\n        singleRotate: false,\n    };\n    // 获取容器元素；\n    this.operator = this.el = _.getEl(el);\n    // 状态记录；\n    this.draging = this.pinching = this.rotating = this.singlePinching = this.singleRotating = false;\n    // 全局参数记录；\n    this.fingers = 0;\n    this.startScale = 1;\n    this.startPoint = {};\n    this.secondPoint = {};\n    this.pinchStartLength = null;\n    this.singlePinchStartLength = null;\n    this.vector1 = {};\n    this.singleBasePoint = {};\n\n    // 初始化注册事件队列；\n    this._driveBus();\n    // 监听原生 touch 事件；\n    this._bind();\n}\n\nMTouch.prototype._driveBus = function() {\n    EVENT.forEach(evName => {\n        this[evName] = new HandlerBus(this.el);\n    });\n};\n\nMTouch.prototype._bind = function() {\n    ORIGINEVENT.forEach(evName => {\n        let fn = evName == 'touchcancel'? 'end': evName.replace('touch', '');\n        // 需要存下 bind(this) 后的函数指向，用于 destroy;\n        this[`_${fn}_bind`] = this[`_${fn}`].bind(this);\n        this.el.addEventListener(evName, this[`_${fn}_bind`], false);\n    });\n};\nMTouch.prototype.destroy = function() {\n    ORIGINEVENT.forEach(evName => {\n        let fn = evName == 'touchcancel' ? 'end' : evName.replace('touch', '');\n        this.el.removeEventListener(evName, this[`_${fn}_bind`], false);\n    });\n};\nMTouch.prototype._start = function(e) {\n    if (!e.touches || e.type !== 'touchstart')return;\n    // 记录手指数量；\n    this.fingers = e.touches.length;\n    // 记录第一触控点；\n    this.startPoint = _.getPoint(e, 0);\n    // 计算单指操作时的基础点；\n    this.singleBasePoint = _.getBasePoint(this.operator);\n    // 双指操作时\n    if (this.fingers > 1) {\n        // 第二触控点；\n        this.secondPoint = _.getPoint(e, 1);\n        // 计算双指向量；\n        this.vector1 = _.getVector(this.secondPoint, this.startPoint);\n        // 计算向量模；\n        this.pinchStartLength = _.getLength(this.vector1);\n    } else if (this.use.singlePinch) {\n        // 单指且监听 singlePinch 时，计算向量模；\n        let pinchV1 = _.getVector(this.startPoint, this.singleBasePoint);\n        this.singlePinchStartLength = _.getLength(pinchV1);\n    }\n    // 触发 touchstart 事件；\n    this.touchstart.fire({origin: e, eventType: 'touchstart'});\n};\nMTouch.prototype._move = function(ev) {\n    if (!ev.touches || ev.type !== 'touchmove')return;\n    // 判断触控点是否为 singlebutton 区域；\n    let isSingleButton = _.data(ev.target,'singleButton'),\n        curFingers = ev.touches.length,\n        curPoint = _.getPoint(ev, 0),\n        singlePinchLength,\n        pinchLength,\n        rotateV1,\n        rotateV2,\n        pinchV2;\n    // 当从原先的两指到一指的时候，可能会出现基础手指的变化，导致跳动；\n    // 因此需屏蔽掉一次错误的touchmove事件，待重新设置基础指后，再继续进行；\n    if (curFingers < this.fingers) {\n        this.startPoint = curPoint;\n        this.fingers = curFingers;\n        return;\n    }\n    // 两指先后触摸时，只会触发第一指一次 touchstart，第二指不会再次触发 touchstart；\n    // 因此会出现没有记录第二指状态，需要在touchmove中重新获取参数；\n    if (curFingers > 1 && (!this.secondPoint || !this.vector1 || !this.pinchStartLength)) {\n        this.secondPoint = _.getPoint(ev, 1);\n        this.vector1 = _.getVector(this.secondPoint, this.startPoint);\n        this.pinchStartLength = _.getLength(this.vector1);\n    }\n    // 双指时，需触发 pinch 和 rotate 事件；\n    if (curFingers > 1) {\n        let curSecPoint = _.getPoint(ev, 1),\n            vector2 = _.getVector(curSecPoint, curPoint);\n        // 触发 pinch 事件；\n        if (this.use.pinch) {\n            pinchLength = _.getLength(vector2);\n            this._eventFire('pinch', {\n                delta: {\n                    scale: pinchLength / this.pinchStartLength,\n                },\n                origin: ev,\n            });\n            this.pinchStartLength = pinchLength;\n        }\n        // 触发 rotate 事件；\n        if (this.use.rotate) {\n            this._eventFire('rotate', {\n                delta: {\n                    rotate: _.getAngle(this.vector1, vector2),\n                },\n                origin: ev,\n            });\n            this.vector1 = vector2;\n        }\n    } else {\n        // 触发 singlePinch 事件;\n        if (this.use.singlePinch && isSingleButton) {\n            pinchV2 = _.getVector(curPoint, this.singleBasePoint);\n            singlePinchLength = _.getLength(pinchV2);\n            this._eventFire('singlePinch', {\n                delta: {\n                    scale: singlePinchLength / this.singlePinchStartLength,\n                },\n                origin: ev,\n            });\n            this.singlePinchStartLength = singlePinchLength;\n        }\n        // 触发 singleRotate 事件;\n        if (this.use.singleRotate && isSingleButton) {\n            rotateV1 = _.getVector(this.startPoint, this.singleBasePoint);\n            rotateV2 = _.getVector(curPoint, this.singleBasePoint);\n            this._eventFire('singleRotate', {\n                delta: {\n                    rotate: _.getAngle(rotateV1, rotateV2),\n                },\n                origin: ev,\n            });\n        }\n    }\n    // 触发 drag 事件；\n    if (this.use.drag) {\n        if (!isSingleButton) {\n            this._eventFire('drag', {\n                delta: {\n                    deltaX: curPoint.x - this.startPoint.x,\n                    deltaY: curPoint.y - this.startPoint.y,\n                },\n                origin: ev,\n            });\n        }\n    }\n    this.startPoint = curPoint;\n    // 触发 touchmove 事件；\n    this.touchmove.fire({eventType: 'touchmove', origin: ev});\n    ev.preventDefault();\n};\nMTouch.prototype._end = function(ev) {\n    if (!ev.touches && ev.type !== 'touchend' && ev.type !== 'touchcancel')return;\n    // 触发 end 事件；\n    ['pinch', 'drag', 'rotate', 'singleRotate', 'singlePinch'].forEach(evName => {\n        this._eventEnd(evName, {origin: ev});\n    });\n    this.touchend.fire({eventType: 'touchend', origin: ev});\n};\nMTouch.prototype._eventFire = function(evName, ev) {\n    let ing = `${evName}ing`,\n        start = `${evName}start`;\n    if (!this[ing]) {\n        ev.eventType = start;\n        this[start].fire(ev);\n        this[ing] = true;\n    } else {\n        ev.eventType = evName;\n        this[evName].fire(ev);\n    }\n};\nMTouch.prototype._eventEnd = function(evName, ev) {\n    let ing = `${evName}ing`,\n        end;\n    if (evName == 'rotate' || evName == 'singleRotate') {\n        end = `${evName}nd`;\n    } else {\n        end = `${evName}end`;\n    }\n    if (this[ing]) {\n        ev.eventType = end;\n        this[end].fire(ev);\n        this[ing] = false;\n    }\n};\n// 添加 button 区域；\n// 背景样式由业务方定制；\nMTouch.prototype._addButton = function(el){\n    let [button] = _.domify(`<div class=\"mtouch-singleButton\" data-singleButton='true' style='position:absolute;right:-15px;bottom: -15px;width:30px;height: 30px;background-size: 100% 100%;'></div>`),\n        _style;\n    el.appendChild(button);\n    el.setAttribute('data-mtouch-addButton',true);\n    if(getComputedStyle && window.getComputedStyle(el,null).position === 'static'){\n        _style = el.style || '';\n        el.style = _style + 'position:relative';\n    }\n};\n// 切换 operator;\nMTouch.prototype.switch = function(el,addButton = true) {\n    let _el;\n    if(!el){\n        this.operator = this.el;\n        return;\n    }\n    this.operator = _el = _.getEl(el);\n    if(!_.data(_el,'mtouch-addButton') && (this.use.singleRotate || this.use.singlePinch) && addButton){\n        this._addButton(_el);\n    }\n};\nMTouch.prototype.on = function(evName, handler = ()=>{}, operator) {\n    if(_.include(evName,' ')){\n        evName.split(' ').forEach(v=>{\n            this._on(v,handler,operator);\n        });\n    }else{\n        this._on(evName,handler,operator);\n    }\n    return this;\n};\nMTouch.prototype._on = function(evName,handler,operator){\n    this.use[_.getUseName(evName)] = true;\n    this[evName].add(handler);\n    this.switch(operator);\n};\nMTouch.prototype.off = function(evName, handler) {\n    this[evName].del(handler);\n};\n","export default {\n    extend(obj1, obj2) {\n        for (let k in obj2) {\n            if (obj2.hasOwnProperty(k)) {\n                if (typeof obj2[k] == 'object') {\n                    if (typeof obj1[k] !== 'object' || obj1[k] === null) {\n                        obj1[k] = {};\n                    }\n                    this.extend(obj1[k], obj2[k]);\n                } else {\n                    obj1[k] = obj2[k];\n                }\n            }\n        }\n        return obj1;\n    },\n    loadImage(image, loaded, error) {\n        let img = new Image();\n        if(image.indexOf('http') == 0){\n            img.crossOrigin = '*';\n        }\n        img.onload = () => {\n            loaded(img);\n        };\n        img.onerror = () => {\n            error('img load error');\n        };\n        img.src = image;\n    },\n    isArr(arr) {\n        return Object.prototype.toString.call(arr) === '[object Array]';\n    },\n    getImage(image,cbk){\n        if(typeof image == 'string'){\n                this.loadImage(image, img => {\n                    cbk(img);\n                },err=>{\n                    console.log(err);\n                });\n        }else if(typeof image == 'object'){\n            cbk(image);\n        }else{\n            console.log('add image error');\n            return;\n        }\n    },\n    forin(obj,cbk){\n        for(let k in obj){\n            if(obj.hasOwnProperty(k)){\n                cbk(k,obj[k]);\n            }\n        }\n    },\n};\n","import _ from './utils';\n\nexport default function MCanvas(cwidth,cheight){\n\n    // 兼容不使用 new 的方式；\n    if (!(this instanceof MCanvas))\n        return new MCanvas(cwidth,cheight);\n\n    // 配置canvas初始大小；\n    // cwidth：画布宽度，Number,选填，默认为 500;\n    // cheight: 画布高度，Number，选填，默认与宽度一致；\n    this.ops = {\n        width: cwidth || 500,\n        height:cheight || cwidth,\n    };\n    // 全局画布；\n    this.canvas = null;\n    this.ctx = null;\n\n    // 绘制函数队列；\n    this.queue = [];\n    // 最后执行的函数；\n    this.end = null;\n\n    // 文字绘制数据；\n    this.textData = {};\n\n    // 背景图数据;\n    this.bgConfig = null;\n\n    // 初始化创建画布；\n    this._init();\n}\n\nMCanvas.prototype._init = function(){\n    this.canvas = document.createElement('canvas');\n    this.canvas.width = this.ops.width;\n    this.canvas.height = this.ops.height;\n    this.ctx = this.canvas.getContext('2d');\n};\n\n// --------------------------------------------------------\n// 绘制背景部分；\n// --------------------------------------------------------\n\nMCanvas.prototype.background = function(bg){\n    if(!bg && this.bgConfig)bg = this.bgConfig;\n    this.bgConfig = bg;\n    this.queue.push(() => {\n        if(bg.color){\n            this.ctx.fillStyle = bg.color;\n            this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);\n        }\n        if(bg.image){\n            _.getImage(bg.image, img =>{\n                this._background(img,bg);\n            });\n        }else{\n            console.error('background image error!');\n        }\n    });\n    return this;\n};\n\nMCanvas.prototype._background = function(img,bg){\n    // 图片与canvas的长宽比；\n    let iRatio = img.naturalWidth / img.naturalHeight;\n    let cRatio = this.canvas.width / this.canvas.height;\n    // 背景绘制参数；\n    let sx,sy,swidth,sheight,dx,dy,dwidth,dheight;\n    switch (bg.type) {\n        // 裁剪模式，固定canvas大小，原图铺满，超出的部分裁剪；\n        case 'crop':\n            sx = bg.left || 0;\n            sy = bg.top || 0;\n            if(iRatio > cRatio){\n                swidth = img.naturalHeight * cRatio;\n                sheight = img.naturalHeight;\n            }else{\n                swidth = img.naturalWidth;\n                sheight = swidth / cRatio;\n            }\n            dy = dx = 0;\n            dheight = this.canvas.height;\n            dwidth = this.canvas.width;\n            break;\n        // 包含模式，固定canvas大小，包含背景图；\n        case 'contain':\n            sy = sx = 0;\n            swidth = img.naturalWidth;\n            sheight = img.naturalHeight;\n            if(iRatio > cRatio){\n                dwidth = this.canvas.width;\n                dheight = dwidth / iRatio;\n                dx = bg.left || 0;\n                dy = (bg.top || bg.top == 0) ? bg.top : (this.canvas.height - dheight)/2;\n            }else{\n                dheight = this.canvas.height;\n                dwidth = dheight * iRatio;\n                dy = bg.top || 0;\n                dx = (bg.left || bg.left == 0) ? bg.left : (this.canvas.width - dwidth)/2;\n            }\n            break;\n        // 原图模式：canvas与原图大小一致，忽略初始化 传入的宽高参数；\n        // 同时，background 传入的 left/top 均被忽略；\n        case 'origin':\n            this.canvas.width = img.naturalWidth;\n            this.canvas.height = img.naturalHeight;\n            sx = sy = 0;\n            swidth = img.naturalWidth;\n            sheight = img.naturalHeight;\n            dx = dy = 0;\n            dwidth = this.canvas.width;\n            dheight = this.canvas.height;\n            break;\n        default:\n            console.err('background type error!');\n    }\n    this.ctx.drawImage(img,sx,sy,swidth,sheight,dx,dy,dwidth,dheight);\n    this._next();\n};\n// --------------------------------------------------------\n// 绘制图层部分；\n// --------------------------------------------------------\n\n// 绘制水印；基于 add 函数封装；\nMCanvas.prototype.watermark = function(image = '',ops){\n    if(!image){\n        console.log('there is not image of watermark');\n        return;\n    }\n    // 参数默认值；\n    let { width = '40%' , pos = 'rightbottom' , margin = 20} = ops;\n    let position = {\n        x:0,\n        y:0,\n        scale:1,\n        rotate:0,\n    };\n    switch (pos) {\n        case 'leftTop':\n            position.x = `left:${margin}`;\n            position.y = `top:${margin}`;\n            break;\n        case 'leftBottom':\n            position.x = `left:${margin}`;\n            position.y = `bottom:${margin}`;\n            break;\n        case 'rightTop':\n            position.x = `right:${margin}`;\n            position.y = `top:${margin}`;\n            break;\n        case 'rightBottom':\n            position.x = `right:${margin}`;\n            position.y = `bottom:${margin}`;\n            break;\n        default:\n    }\n    this.add(image,{\n        width,\n        pos:position,\n    });\n    return this;\n};\n\n// 通用绘制图层函数；\n// 使用方式：\n// 多张图: add([{image:'',options:{}},{image:'',options:{}}]);\n// 单张图: add(image,options);\nMCanvas.prototype.add = function(image = '',options){\n    // 默认参数；\n    let def = {\n        width:'100%',\n        crop:{\n            x:0,\n            y:0,\n            width:'100%',\n            height:'100%',\n        },\n        pos:{\n            x:0,\n            y:0,\n            scale:1,\n            rotate:0,\n        },\n    };\n\n    if(!_.isArr(image))image = [{image,options}];\n\n    image.forEach( v =>{\n        // 将封装好的 add函数 推入队列中待执行；\n        // 参数经过 _handleOps 加工；\n        this.queue.push(() => {\n            _.getImage(v.image, img => {\n                this._add(img,this._handleOps(_.extend(def,v.options),img));\n            });\n        });\n    });\n\n    return this;\n};\n\nMCanvas.prototype._add = function(img,ops){\n    let ratio = img.naturalWidth / img.naturalHeight;\n    // 画布canvas参数；\n    let cdx,cdy,cdw,cdh;\n    // 素材canvas参数；\n    let { x:lsx, y:lsy, width:lsw, height:lsh} = ops.crop;\n    let ldx,ldy,ldw,ldh;\n    //  素材的真实宽高，用于剔除避免裁剪所添加的空白区域；\n    let rw,rh,rspaceX,rspaceY;\n\n    // 素材canvas的绘制;\n    let lcvs = document.createElement('canvas');\n    let lctx = lcvs.getContext('2d');\n\n    // 取最长边为边长，正方形,避免旋转的时候被裁剪；\n    lcvs.height = lcvs.width = ratio > 1 ? img.naturalWidth : img.naturalHeight;\n\n    // 从素材canvas的中心点开始绘制；\n    ldx = -img.naturalWidth/2;\n    ldy = -img.naturalHeight/2;\n    ldw = img.naturalWidth;\n    ldh = img.naturalHeight;\n\n    lctx.translate(lcvs.width/2,lcvs.height/2);\n    lctx.rotate(ops.pos.rotate);\n    lctx.drawImage(img,lsx,lsy,lsw,lsh,ldx,ldy,ldw,ldh);\n\n    // lcvs.style = 'width:300px';\n    // document.querySelector('body').appendChild(lcvs);\n\n    // 获取素材最终的宽高;\n    // 由于前面的素材canvas已经绘制成正方形，所以 w = h;\n    cdh = cdw = ops.width;\n\n    // 计算绘制成正方形造成的空白区域；\n    if(ratio > 1){\n        rh = cdw / ratio;\n        rw = 0;\n        rspaceX = 0;\n        rspaceY = (cdh-rh)/2;\n    }else{\n        rw = cdh * ratio;\n        rh = 0;\n        rspaceX = (cdw - rw)/2;\n        rspaceY = 0;\n    }\n\n    // 获取素材的位置；\n    //    配置的位置 - 缩放的影响 - 绘制成正方形的影响；\n    cdx = ops.pos.x + cdw * ( 1 - ops.pos.scale )/2 - rspaceX;\n    cdy = ops.pos.y + cdh * ( 1 - ops.pos.scale )/2 - rspaceY;\n\n    // 计算配置的缩放值；\n    cdh = cdw *= ops.pos.scale;\n\n    this.ctx.drawImage(lcvs,cdx,cdy,cdw,cdh);\n    this._next();\n};\n// 参数加工函数；\nMCanvas.prototype._handleOps = function(ops,img){\n\n    let cw = this.canvas.width,\n        ch = this.canvas.height,\n        iw = img.naturalWidth,\n        ih = img.naturalHeight;\n\n    // 图片宽高比；\n    let ratio = iw / ih;\n\n    // 根据参数计算后的绘制宽度；\n    let width =  this._get(cw,iw,ops.width,'pos');\n\n    // 裁剪的最大宽高；\n    let maxLsw,maxLsh;\n\n    // 裁剪参数；\n    let { x:cropx,y:cropy,width:cropw,height:croph } = ops.crop;\n    let crop = {\n        x: this._get(cw,iw,cropx,'crop'),\n        y: this._get(ch,ih,cropy,'crop'),\n        width:this._get(cw,iw,cropw,'crop'),\n        height:this._get(ch,ih,croph,'crop'),\n    };\n    // 最大值判定；\n    if(crop.x > iw)crop.x = iw;\n    if(crop.y > ih)crop.y = ih;\n    maxLsw = img.naturalWidth - crop.x;\n    maxLsh = img.naturalHeight - crop.y;\n    if(crop.width > maxLsw)crop.width = maxLsw;\n    if(crop.height > maxLsh)crop.height = maxLsh;\n\n    // 位置参数；\n    let { x: px, y: py, rotate: pr, scale: ps } = ops.pos;\n    let pos = {\n        x:this._get(cw,width,px,'pos'),\n        y:this._get(ch,width/ratio,py,'pos'),\n        scale : ps,\n        rotate : parseFloat(pr) * Math.PI / 180,\n    };\n    return {width,crop,pos};\n};\n\n// --------------------------------------------------------\n// 绘制文字部分；\n// --------------------------------------------------------\nMCanvas.prototype.text = function(context = '', ops){\n    // 默认字体；\n    let fontFamily = `helvetica neue,hiragino sans gb,Microsoft YaHei,arial,tahoma,sans-serif`;\n    // 默认的字体大小;\n    let size = this.canvas.width / 20;\n\n    this.queue.push(()=>{\n        let option = {\n            width : 300,\n            align : 'left',\n            smallStyle:{\n                font : `${size * 0.8}px ${fontFamily}`,\n                color:'#000',\n                lineheight:size * 0.9,\n            },\n            normalStyle:{\n                font : `${size }px ${fontFamily}`,\n                color:'#000',\n                lineheight:size*1.1,\n            },\n            largeStyle:{\n                font : `${size * 1.3}px ${fontFamily}`,\n                color:'#000',\n                lineheight:size * 1.4,\n            },\n            pos:{\n                x:0,\n                y:0,\n            },\n        };\n        option = _.extend(option,ops);\n\n        // 解析字符串模板后，调用字体绘制函数；\n        this._text(this._parse(context),option);\n        this._next();\n    });\n    return this;\n};\n// 字符串模板解析函数\n// 解析 <s></s> <b></b>\nMCanvas.prototype._parse = function(context){\n    let arr = context.split(/<s>|<b>/);\n    let result = [];\n    for(let i=0;i<arr.length;i++){\n        let value = arr[i];\n        if(/<\\/s>|<\\/b>/.test(value)){\n            let splitTag = /<\\/s>/.test(value) ? '</s>' : '</b>',\n                type     = /<\\/s>/.test(value) ? 'small' : 'large';\n            let tmp = arr[i].split(splitTag);\n            result.push({\n                type:type,\n                text:tmp[0],\n            });\n            tmp[1] && result.push({\n                type:'normal',\n                text:tmp[1],\n            });\n            continue;\n        }\n        arr[i] && result.push({\n            text:arr[i],\n            type:'normal',\n        });\n    }\n    return result;\n};\nMCanvas.prototype._text = function(textArr,option){\n    // 处理宽度参数；\n    option.width = this._get(this.canvas.width,0,option.width,'pos');\n\n    let style,line = 1,length = 0,\n        lineheight = getLineHeight(textArr,option),\n        x = this._get(this.canvas.width,option.width,option.pos.x,'pos'),\n        y = (this._get(this.canvas.height,0,option.pos.y,'pos')) + lineheight;\n\n    // data:字体数据；\n    // lineWidth:行宽；\n    this.textData[line] = {\n        data:[],\n        lineWidth:0,\n    };\n\n    // 生成字体数据；\n    textArr.forEach(v =>{\n        style = option[`${v.type}Style`];\n        this.ctx.font = style.font;\n        let width = this.ctx.measureText(v.text).width;\n\n        // 处理 <br> 换行，先替换成 '|',便于单字绘图时进行判断；\n        let context = v.text.replace(/<br>/g,'|');\n\n        // 先进行多字超出判断，超出宽度后再进行单字超出判断；\n        if((length + width) > option.width || context.indexOf('|') !== -1){\n            for (let i=0,fontLength = context.length; i < fontLength; i++) {\n                let font = context[i];\n                width = this.ctx.measureText(font).width;\n\n                // 当字体的计算宽度 > 设置的宽度 || 内容中包含换行时,进入换行逻辑；\n                if((length + width) > option.width || font == '|'){\n                    length = 0;\n                    x = this._get(this.canvas.width,option.width,option.pos.x,'pos');\n                    y += lineheight;\n                    line += 1;\n                    this.textData[line] = {\n                        data:[],\n                        lineWidth:0,\n                    };\n                    if(font == '|')continue;\n                }\n                this.textData[line]['data'].push({\n                    context:font,x,y,style,width,\n                });\n                length += width;\n                x += width;\n                this.textData[line]['lineWidth'] = length;\n            }\n        }else{\n            this.textData[line]['data'].push({\n                context,x,y,style,width,\n            });\n            length += width;\n            x += width;\n            this.textData[line]['lineWidth'] = length;\n        }\n    });\n\n    // 通过字体数据进行文字的绘制；\n    _.forin(this.textData,(k,v)=>{\n        // \b增加 align 的功能；\n        let add = 0;\n        if(v.lineWidth < option.width){\n            if(option.align == 'center'){\n                add = (option.width - v.lineWidth)/2;\n            }else if (option.align == 'right') {\n                add = option.width - v.lineWidth;\n            }\n        }\n        v.data.forEach(text=>{\n            text.x += add;\n            this._fillText(text);\n        });\n    });\n\n    // 获取行高；\n    function getLineHeight(textArr,option) {\n        let lh = 0,vlh;\n        textArr.forEach( v =>{\n            vlh = option[`${v.type}Style`].lineheight;\n            if(vlh > lh)lh = vlh;\n        });\n        return lh;\n    }\n};\nMCanvas.prototype._fillText = function(text){\n    let {context,x,y,style} = text;\n    this.ctx.font = style.font;\n    this.ctx.textAlign = style.align;\n    this.ctx.textBaseline = 'bottom';\n    this.ctx.fillStyle = style.color;\n    this.ctx.fillText(context,x,y);\n};\n\n// --------------------------------------------------------\n// 业务功能函数部分\n// --------------------------------------------------------\n\n// 参数加工函数；\n// 兼容 5 种 value 值：\n// x:250, x:'250px', x:'100%', x:'left:250',x:'center',\n// width:100,width:'100px',width:'100%'\nMCanvas.prototype._get = function(par,child,str,type){\n    let result = str;\n    if(typeof str === 'string'){\n        if(str.indexOf(':') !== -1 && type == 'pos'){\n            let arr = str.split(':');\n            switch (arr[0]) {\n                case 'left':\n                case 'top':\n                    result = +(arr[1].replace('px',''));\n                    break;\n                case 'right':\n                case 'bottom':\n                    result = par - (+(arr[1].replace('px',''))) - child;\n                    break;\n                default:\n            }\n        }else if (str.indexOf('px') !== -1) {\n            result = (+str.replace('px', ''));\n        } else if (str.indexOf('%') !== -1) {\n            if(type == 'crop'){\n                result = child * (+str.replace('%', '')) / 100;\n            }else{\n                result = par * (+str.replace('%', '')) / 100;\n            }\n        }else if(str == 'center'){\n            result = (par-child)/2;\n        }else{\n            result = +str;\n        }\n    }\n    return result;\n};\n\n// 绘制函数；\nMCanvas.prototype.draw = function(fn = ()=>{}){\n    let b64;\n    this.end = () => {\n        setTimeout(()=>{\n            b64 = this.canvas.toDataURL('image/png');\n            fn(b64);\n        },0);\n    };\n    this._next();\n    return this;\n};\nMCanvas.prototype._next = function(){\n    if(this.queue.length > 0){\n        this.queue.shift()();\n    }else{\n        this.end();\n    }\n};\n","let sheet;\nexport default {\n    setPos(el, transform) {\n        let str = JSON.stringify(transform);\n        let value = `translate3d(${transform.x}px,${transform.y}px,0px) scale(${transform.scale}) rotate(${transform.rotate}deg)`;\n        el = this.getEl(el);\n        el.style.transform = value;\n        el.style.webkitTransform = value;\n        el.setAttribute('data-mtouch-status', str);\n    },\n    getPos(el) {\n        if(!el)return;\n        let defaulTrans;\n        let style = window.getComputedStyle(el,null);\n        let cssTrans = style.transform || style.webkitTransform;\n\n        if(window.getComputedStyle && cssTrans !== 'none'){\n            defaulTrans = this.matrixTo(cssTrans);\n        }else{\n            defaulTrans = {\n                x: 0,\n                y: 0,\n                scale: 1,\n                rotate: 0,\n            };\n        }\n        return JSON.parse(el.getAttribute('data-mtouch-status')) || defaulTrans;\n    },\n    extend(obj1, obj2) {\n        for (let k in obj2) {\n            if (obj2.hasOwnProperty(k)) {\n                if(typeof obj2[k] == 'object' && !(obj2[k] instanceof Node)){\n                    if(typeof obj1[k] !== 'object' || obj1[k] === null){\n                        obj1[k] = {};\n                    }\n                    this.extend(obj1[k],obj2[k]);\n                }else{\n                    obj1[k] = obj2[k];\n                }\n            }\n        }\n        return obj1;\n    },\n    getOffset(el){\n        el = this.getEl(el);\n        let offset = {};\n        offset.width = el.offsetWidth;\n        offset.height = el.offsetHeight;\n        return offset;\n    },\n    matrixTo(matrix){\n        // 解析 matrix 字符串，分割成数组；\n        let arr = (matrix.replace('matrix(','').replace(')','')).split(',');\n        // 根据不等式计算出 rotate 和 scale；\n        let cos = arr[0],\n            sin = arr[1],\n            tan = sin/cos,\n            rotate = Math.atan(tan)*180/Math.PI,\n            scale = cos/(Math.cos(Math.PI/180*rotate)),\n            trans;\n        // 传入翻译后的各项参数；\n        trans = {\n            x:parseInt(arr[4]),\n            y:parseInt(arr[5]),\n            scale,\n            rotate,\n        };\n        return trans;\n    },\n    domify(DOMString) {\n        let htmlDoc = document.implementation.createHTMLDocument();\n        htmlDoc.body.innerHTML = DOMString;\n        return htmlDoc.body.children;\n    },\n    getEl(el){\n        if(!el){\n            console.error('el error,there must be a el!');\n            return;\n        }\n        let _el;\n        if(typeof el == 'string'){\n            _el = document.querySelector(el);\n        }else if(el instanceof Node){\n            _el = el;\n        }else{\n            console.error('el error,there must be a el!');\n            return;\n        }\n        return _el;\n    },\n    addClass(el,cls){\n        let _cls;\n        el = this.getEl(el);\n        _cls = this.trim(el.className) || '';\n        if(_cls.indexOf(cls) == -1){\n            if(_cls.length == 0){\n                el.className = cls;\n            }else{\n                el.className = _cls + ` ${cls}`;\n            }\n        }\n    },\n    trim(str){\n        if(typeof str == 'string'){\n            return str.replace(/(^\\s*)|(\\s*$)/g, '');\n        }\n    },\n    removeClass(el,cls){\n        let _cls;\n        el = this.getEl(el);\n        _cls = el.className || '';\n        if(_cls.indexOf(cls) !== -1){\n            el.className = _cls.replace(new RegExp(cls, 'g'),'');\n        }\n    },\n    hasClass(el,cls){\n        el = this.getEl(el);\n        return el.className.indexOf(cls) !== -1;\n    },\n    forin(obj,cbk){\n        for(let k in obj){\n            if(obj.hasOwnProperty(k)){\n                cbk(k,obj[k]);\n            }\n        }\n    },\n    data(el,key){\n        el = this.getEl(el);\n        return el.getAttribute(`data-${key}`);\n    },\n    include(str1,str2){\n        if(str1.indexOf){\n            return str1.indexOf(str2) !== -1;\n        }else{\n            return false;\n        }\n    },\n    delegate(par,evName,child,fn = ()=>{}){\n        let _par = this.getEl(par);\n        _par.addEventListener(evName,ev=>{\n            let target = ev.target;\n            while(target !== _par ){\n                if(child.indexOf('.') == 0){\n                    if(this.include(target.className,child.substring(1))){\n                        ev.delegateTarget = target;\n                        fn.bind(target)(ev);\n                        break;\n                    }\n                }else if(child.indexOf('#') == 0){\n                    if(target.id == child.substring(1)){\n                        ev.delegateTarget = target;\n                        fn.bind(target)(ev);\n                        break;\n                    }\n                }else{\n                    if(target.tagName.toLowerCase() == child){\n                        ev.delegateTarget = target;\n                        fn.bind(target)(ev);\n                        break;\n                    }\n                }\n                target = target.parentNode;\n            }\n        });\n    },\n    addCssRule(selector, rules){\n        if(!sheet){\n            sheet = createStyleSheet();\n        }\n        sheet.insertRule(`${selector}{${rules}}`,sheet.rules.length);\n    },\n    remove(el){\n        let _par = el.parentNode || el.parentElement;\n        _par.removeChild(el);\n    },\n    loadImage(image, success, error) {\n        let img = new Image();\n        let loaded = false;\n        if(image.indexOf('http') == 0){\n            img.crossOrigin = '*';\n        }\n        img.onload = () => {\n            if(!loaded){\n                loaded = true;\n                success(img);\n            }\n        };\n        img.onerror = () => {\n            error('img load error');\n        };\n        img.src = image;\n    },\n    getImage(image,cbk){\n        if(typeof image == 'string'){\n            this.loadImage(image, img => {\n                cbk(img);\n            },err=>{\n                console.log(err);\n            });\n        }else if(typeof image == 'object' && image instanceof Node){\n            cbk(image);\n        }else{\n            console.log('add image error');\n            return;\n        }\n    },\n};\n\nfunction createStyleSheet() {\n    let style = document.createElement('style');\n    style.type = 'text/css';\n    document.head.appendChild(style);\n    return style.sheet;\n}\n","// 素材层级管理系统；\nimport _ from './utils';\nexport default class ZIndex {\n    constructor(config) {\n        this.config = {\n            'min': 50,\n            'max': 100,\n        };\n        this.config = _.extend(this.config, config);\n        this.topIndex = this.config.min;\n        this.zIndexArr = [];\n    }\n    init(){\n        this.zIndexArr = [];\n        this.topIndex = this.config.min;\n    }\n    setIndex(id) {\n        this.zIndexArr.push(id);\n        if (this.topIndex > this.config.max) {\n            this.resetIndex();\n        } else {\n            let el = document.querySelector(`#${id}`);\n            el.style.zIndex = this.topIndex;\n            this.topIndex++;\n        }\n    }\n    removeIndex(id) {\n        this.zIndexArr.forEach((value, index, arr) => {\n            if (value == id) {\n                arr.splice(index, 1);\n            }\n        });\n    }\n    resetIndex() {\n        this.zIndexArr.forEach((id, index) => {\n            let el = document.querySelector(`#${id}`);\n            el.style.zIndex = this.config.min+index;\n        });\n        this.topIndex = this.zIndexArr.length + this.config.min;\n    }\n    toTop(id) {\n        if (id !== this.zIndexArr[this.zIndexArr.length - 1]) {\n            this.removeIndex(id);\n            this.setIndex(id);\n        }\n    }\n}\n","import MT from '@meitu/mtouch';\nimport MC from '@meitu/mcanvas';\nimport ZIndex from './zIndex';\nimport _ from './utils';\n\nconst EVENT = ['touchstart','touchmove','touchend','drag','dragstart','dragend','pinch','pinchstart','pinchend','rotate','rotatestart','rotatend','singlePinchstart','singlePinch','singlePinchend','singleRotate','singleRotatestart','singleRotatend'];\n\nwindow.requestAnimFrame = (function() {\n    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || function(callback) {\n        window.setTimeout(callback, 1000 / 60);\n    };\n})();\n\nexport default function Touchkit(ops) {\n    // 兼容不使用 new 的方式；\n    if (!(this instanceof Touchkit))\n        return new Touchkit(ops);\n\n    this._ops = {\n        el: null,\n        // event\n        event:{\n            touchstart() {},\n            touchmove() {},\n            touchend() {},\n\n            dragstart() {},\n            drag(){},\n            dragend() {},\n\n            pinchstart() {},\n            pinch(){},\n            pinchend() {},\n\n            rotatestart() {},\n            rotate(){},\n            rotatend() {},\n\n            singlePinchstart(){},\n            singlePinch(){},\n            singlePinchend(){},\n\n            singleRotatestart(){},\n            singleRotate(){},\n            singleRotatend(){},\n        },\n    };\n\n    if(ops.event || ops.el){\n        this._ops = _.extend(this._ops, ops);\n    }else{\n        this._ops.el = _.getEl(ops);\n    }\n\n    // 手势容器；\n    this.el = _.getEl(this._ops.el);\n\n    this.elStatus = {\n        width:this.el.clientWidth || this.el.offsetWidth,\n        height:this.el.clientHeight || this.el.offsetHeight,\n    };\n\n    this.operator = null;\n\n    this.operatorStatus = null;\n\n    this.transform = null;\n\n    this.freezed = false;\n\n    this._childs = {};\n\n    this._childIndex = 0;\n\n    this._zIndexBox = new ZIndex();\n\n    this.mt = MT(this.el);\n\n    this._bind();\n\n    this.insertCss();\n\n}\n\nTouchkit.prototype.insertCss = function(){\n    _.addCssRule('.mtouch-singleButton','display: none;');\n    _.addCssRule('.mt-active','z-index: 99;outline:2px solid hsla(0,0%,100%,.5);');\n    _.addCssRule('.mt-active .mtouch-singleButton,.mt-active .mt-close-btn','display: inline-block;');\n    _.addCssRule('.mt-child','position:absolute;text-align:left;');\n    _.addCssRule('.mt-image','width:100%;height:100%;position:absolute;text-align:left;');\n    _.addCssRule('.mt-close-btn','position:absolute;width:30px;height:30px;top:-15px;right:-15px;background-size:100%;display:none;');\n    _.addCssRule('.mt-background','position:absolute;left:0;top:0;');\n};\n\nTouchkit.prototype.background = function(ops){\n    let _ops = {\n        // 背景图片，type: url/HTMLImageElement/HTMLCanvasElement\n        image:'' ,\n        // 绘制方式: origin / crop / contain\n            // crop : 裁剪模式，背景图自适应铺满画布，多余部分裁剪；可通过 left/top值控制裁剪部分；\n            // contain : 包含模式, 类似于 background-size:contain; 可通过left/top值进行位置的控制；\n        type:'contain',\n        // 背景图片距离画布左上角的距离，\n        left:0,\n        top:0,\n        // 除了背景图外的颜色，仅在 type:contain时可见；\n        color:'#000000',\n        use:{\n            drag:true,\n        },\n    };\n    _ops = _.extend(_ops,ops);\n    _.getImage(_ops.image,img=>{\n        let iw = img.naturalWidth,\n            ih = img.naturalHeight,\n            iratio = iw / ih;\n        let pw = this.elStatus.width,\n            ph = this.elStatus.height,\n            pratio = pw / ph;\n        let left,top,width,height;\n        let minX = 0 , minY = 0;\n        let ratio;\n\n        _.addClass(img,'mt-background');\n        img.setAttribute('data-mt-index','background');\n        img.setAttribute('data-mt-bg-type',_ops.type);\n\n        if(_ops.type == 'contain'){\n            if(iratio > pratio){\n                left = _ops.left || 0;\n                top = _ops.top || (ph - pw/iratio) / 2;\n                width = pw;\n                height = pw / iratio;\n                ratio = iw / width;\n            }else{\n                left = _ops.left || (pw - ph*iratio) / 2;\n                top = _ops.top || 0;\n                width = ph*iratio;\n                height = ph;\n                ratio = ih / height;\n            }\n        }else if(_ops.type == 'crop'){\n            left = 0;\n            top = 0;\n            if(iratio > pratio){\n                width = ph*iratio;\n                height = ph;\n                minX = (width - pw)/width;\n                ratio = ih / height;\n            }else{\n                width = pw;\n                height = pw/iratio;\n                minY = (height - ph)/height;\n                ratio = iw / width;\n            }\n            _ops.limit = {\n                x:minX,\n                y:minY,\n                maxScale:1,\n                minScale:1,\n            };\n        }\n        img.style = `width:${width}px;height:${height}px;left:${left}px;top:${top}px`;\n        this.el.setAttribute('data-mt-ratio',ratio);\n        this.el.appendChild(img);\n\n        this._childs.background = {\n            el:img,\n            ops: _ops,\n        };\n    });\n};\n\nTouchkit.prototype.add = function(ops){\n    let _ops = {\n        image:'',\n        width:'',\n        height:'',\n        use:{\n            drag:false,\n            pinch:false,\n            rotate:false,\n            singlePinch:false,\n            singleRotate:false,\n        },\n        limit:false,\n        pos:{\n            x:0,\n            y:0,\n            scale:1,\n            rotate:0,\n        },\n        close:false,\n    };\n    _ops = _.extend(_ops,ops);\n    _.getImage(_ops.image,img=>{\n        let iw = img.naturalWidth,\n            ih = img.naturalHeight,\n            iratio = iw / ih;\n        let _templateEl = img;\n        _.addClass(_templateEl,'mt-image');\n        let _ele = _.domify(`<div class=\"mt-child\" id=\"mt-child-${this._childIndex}\" data-mt-index=\"${this._childIndex}\"></div>`)[0];\n        let originWidth = this._get('width',_ops.width);\n        let originHeight = originWidth / iratio;\n        let spaceX = (_ops.pos.scale - 1) * originWidth/2;\n        let spaceY = (_ops.pos.scale - 1) * originHeight/2;\n        _ele.style.width =  originWidth + 'px';\n        _ele.style.height =  originHeight + 'px';\n        _ele.appendChild(_templateEl);\n\n        if(_ops.close){\n            let _closeBtnEl = _.domify(`<div class=\"mt-close-btn\"></div>`)[0];\n            _ele.appendChild(_closeBtnEl);\n        }\n        this.el.appendChild(_ele);\n        this._childs[this._childIndex] = {\n            el:_ele,\n            ops: _ops,\n        };\n        this._zIndexBox.setIndex(`mt-child-${this._childIndex}`);\n        let addButton = (_ops.use.singlePinch || _ops.use.singleRotate) ? true : false;\n        this.switch(_ele,addButton);\n        this.setTransform(_ele,{\n            x:this._get('width',_ops.pos.x) + spaceX,\n            y:this._get('height',_ops.pos.y) + spaceY,\n            scale:_ops.pos.scale,\n            rotate:_ops.pos.rotate,\n        });\n        this._childIndex++;\n    });\n};\n\nTouchkit.prototype._bind = function(){\n    EVENT.forEach(evName=>{\n        if(!this[evName]){\n            this[evName] = () =>{\n                this._ops.event[evName]();\n            };\n        }\n        this.mt.on(evName,this[evName].bind(this));\n    });\n\n    this.el.addEventListener('click',ev=>{\n        if(!this.isAdd(ev.target)){\n            this.switch(null);\n        }\n        if(_.hasClass(ev.target,'mt-background') && _.data(ev.target,'mt-bg-type') == 'crop'){\n            this.operator = ev.target;\n            this.operatorStatus = this.operator ? this.operator.getBoundingClientRect() : {};\n        }\n\n    });\n\n    _.delegate(this.el,'click','.mt-child',ev=>{\n        let el = ev.delegateTarget;\n        let _ops = this._getOperatorOps(el);\n        let _addButton = (_ops.use.singlePinch || _ops.use.singleRotate) ? true : false;\n        this.switch(el,_addButton);\n        this._zIndexBox.toTop(el.id);\n    });\n\n    _.delegate(this.el,'click','.mt-close-btn',ev=>{\n        let _el = ev.delegateTarget;\n        let _child = _el.parentNode || _el.parentElement;\n        let id = _child.getAttribute('id') || '';\n        this._zIndexBox.removeIndex(id);\n        _.remove(_child);\n    });\n};\n\nTouchkit.prototype.touchstart = function(ev){\n    if(this.operator){\n        this.transform = _.getPos(this.operator);\n    }\n    this._ops.event.touchstart(ev);\n};\n\nTouchkit.prototype.drag = function(ev){\n    if(this.operator && !this.freezed){\n        let ops = this._getOperatorOps();\n        if(ops.use.drag){\n            this.transform.x += ev.delta.deltaX;\n            this.transform.y += ev.delta.deltaY;\n            this.setTransform();\n        }\n    }\n    this._ops.event.drag(ev);\n};\n\nTouchkit.prototype.pinch = function(ev){\n    if(this.operator && !this.freezed){\n        let ops = this._getOperatorOps();\n        if(ops.use.pinch){\n            this.transform.scale *= ev.delta.scale;\n            this.setTransform();\n        }\n    }\n    this._ops.event.pinch(ev);\n};\nTouchkit.prototype.rotate = function(ev){\n    if(this.operator && !this.freezed){\n        let ops = this._getOperatorOps();\n        if(ops.use.rotate){\n            this.transform.rotate += ev.delta.rotate;\n            this.setTransform();\n        }\n    }\n    this._ops.event.rotate(ev);\n};\nTouchkit.prototype.singlePinch = function(ev){\n    if(this.operator && !this.freezed){\n        let ops = this._getOperatorOps();\n        if(ops.use.singlePinch){\n            this.transform.scale *= ev.delta.scale;\n            this.setTransform();\n        }\n    }\n    this._ops.event.singlePinch(ev);\n};\nTouchkit.prototype.singleRotate = function(ev){\n    if(this.operator && !this.freezed){\n        let ops = this._getOperatorOps();\n        if(ops.use.singleRotate){\n            this.transform.rotate += ev.delta.rotate;\n            this.setTransform();\n        }\n    }\n    this._ops.event.singleRotate(ev);\n};\nTouchkit.prototype.setTransform = function(el = this.operator, transform = this.transform) {\n    let trans = JSON.parse(JSON.stringify(transform));\n    let ops = this._getOperatorOps();\n    let defaulLimit = {\n        x:0.5,\n        y:0.5,\n        maxScale:3,\n        minScale:0.4,\n    };\n    let _limit = (ops.limit && ops.limit !== true) ? _.extend(defaulLimit,ops.limit) : defaulLimit;\n    if(ops.limit){\n        trans = this.limitOperator(trans,_limit);\n    }\n    // 当 isHold 参数开启时，反向设置按钮的scale值，使按钮大小保持不变；\n    if(ops.use.singlePinch){\n        let singlePinchBtn = el.querySelector(`.mtouch-singleButton`);\n            singlePinchBtn.style.transform = `scale(${1/trans.scale})`;\n            singlePinchBtn.style.webkitTransform = `scale(${1/trans.scale})`;\n    }\n    if(ops.use.singleRotate){\n        let singleRotateBtn = el.querySelector(`.mtouch-singleButton`);\n            singleRotateBtn.style.transform = `scale(${1/trans.scale})`;\n            singleRotateBtn.style.webkitTransform = `scale(${1/trans.scale})`;\n    }\n    if(ops.close){\n        let closeBtn = el.querySelector(`.mt-close-btn`);\n        closeBtn.style.webkitTransform = `scale(${1/trans.scale})`;\n        closeBtn.style.webkitTransform = `scale(${1/trans.scale})`;\n    }\n    window.requestAnimFrame(()=>{\n        _.setPos(el, trans);\n    });\n};\nTouchkit.prototype.limitOperator = function(transform,limit) {\n    // 实时获取操作元素的状态；\n    let {minScale, maxScale} = limit;\n    if (minScale && transform.scale < minScale){\n        transform.scale = minScale;\n    }\n    if (maxScale && transform.scale > maxScale){\n        transform.scale = maxScale;\n    }\n    let operatorStatus = _.getOffset(this.operator);\n    // 因缩放产生的间隔；\n    let spaceX = operatorStatus.width * (transform.scale - 1) / 2;\n    let spaceY = operatorStatus.height * (transform.scale - 1) / 2;\n    // 参数设置的边界值；\n    let boundaryX = operatorStatus.width * transform.scale  * (limit.x);\n    let boundaryY = operatorStatus.height * transform.scale * (limit.y);\n    // 4个边界状态；\n    let minX = spaceX - boundaryX;\n    let minY = spaceX - boundaryY;\n    let maxX = this.elStatus.width - operatorStatus.width * transform.scale + spaceX + boundaryX;\n    let maxY = this.elStatus.height - operatorStatus.height * transform.scale + spaceY + boundaryY;\n\n    if(limit.x || limit.x == 0){\n        if(transform.x >= maxX)transform.x = maxX;\n        if(transform.x < minX)transform.x = minX;\n    }\n    if(limit.y || limit.y == 0){\n        if(transform.y > maxY)transform.y = maxY;\n        if(transform.y < minY)transform.y = minY;\n    }\n    return transform;\n};\nTouchkit.prototype.switch = function(el,addButton){\n    el = typeof el == 'string'? document.querySelector(el):el;\n    _.forin(this._childs,(k,v)=>{\n        _.removeClass(v.el,'mt-active');\n    });\n    // 转换操作元素后，也需要重置 mtouch 中的单指缩放基本点 singleBasePoint;\n    this.mt && this.mt.switch(el,addButton);\n    this.operator = el;\n    this.operatorStatus = this.operator ? this.operator.getBoundingClientRect() : {};\n    if(el){\n        _.addClass(el,'mt-active');\n    }\n    return this;\n};\nTouchkit.prototype._getOperatorOps = function(target){\n    let _tar = target || this.operator;\n    let index = _.data(_tar,'mt-index');\n    return this._childs[index].ops;\n};\nTouchkit.prototype.freeze = function(boolean){\n    this.freezed = boolean ? true:false;\n    return this;\n};\nTouchkit.prototype.destory = function(){\n    this.mtouch && this.mtouch.destroy();\n    this.mtouch = null;\n};\n// 参数加工函数；\n// 兼容 5 种 value 值：\n// x:250, x:'250px', x:'100%', x:'left:250',x:'center',\n// width:100,width:'100px',width:'100%'\nTouchkit.prototype._get = function(drection,str){\n    let result = str;\n    let k = drection == 'width' ? 'offsetWidth':'offsetHeight';\n    let par = this.el[k],\n        child = this.operator ? this.operator[k] : 0;\n    if(typeof str === 'string'){\n        if(_.include(str,':')){\n            let arr = str.split(':');\n            switch (arr[0]) {\n                case 'left':\n                case 'top':\n                    result = +(arr[1].replace('px',''));\n                    break;\n                case 'right':\n                case 'bottom':\n                    result = par - (+(arr[1].replace('px',''))) - child;\n                    break;\n                default:\n            }\n        }else if (str.indexOf('px') !== -1) {\n            result = (+str.replace('px', ''));\n        } else if (str.indexOf('%') !== -1) {\n            result = par * (+str.replace('%', '')) / 100;\n        }else if(str == 'center'){\n            result = (par-child)/2;\n        }else{\n            result = +str;\n        }\n    }\n    return result;\n};\n\nTouchkit.prototype.isAdd = function(el){\n    let target = el;\n    while(target !== this.el || target.tagName.toLowerCase() == 'body'){\n        if(_.include(target.className,'mt-child')){\n            return true;\n        }\n        target = target.parentNode;\n    }\n    return false;\n};\n\nTouchkit.prototype.exportImage = function(cbk){\n    let cwidth = this.elStatus.width,\n        cheight = this.elStatus.height;\n    let ratio = +_.data(this.el,'mt-ratio');\n    let mc = new MC(cwidth*ratio,cheight*ratio);\n    let bg = this._childs.background;\n    let addChilds = [];\n    this._zIndexBox.zIndexArr.forEach(v=>{\n        let _child = document.querySelector('#'+v);\n        let _image = _child.querySelector('.mt-image');\n        let childPos = JSON.parse(_.data(_child,'mtouch-status'));\n        childPos.x *= ratio;\n        childPos.y *= ratio;\n        addChilds.push({\n            image:_image,\n            options:{\n                width: _image.offsetWidth * ratio,\n                pos:childPos,\n            },\n        });\n    });\n\n    let bgLeft,bgTop;\n    if(bg.ops.type == 'crop'){\n        let bgPos = JSON.parse(_.data(bg.el,'mtouch-status')) || {left:0,top:0,scale:1,rotate:0};\n        bgLeft = -bgPos.x;\n        bgTop = -bgPos.y;\n    }else{\n        bgLeft = bg.ops.left;\n        bgTop = bg.ops.top;\n    }\n    mc.background({\n        image:bg.el,\n        type:bg.ops.type,\n        left:bgLeft,\n        top:bgTop,\n    }).add(addChilds).draw(b64=>{\n        cbk(b64);\n    });\n};\n","import Touchkit from '../src/index';\n\nlet w = $(window).width();\n\n$('.item').css({\n    width:w+'px',\n    height:(w+100)+'px',\n});\n\nlet Tk = new Touchkit({\n    el:'.js-par',\n});\nTk.background({\n    image:'./images/p2.jpg',\n    type:'crop',\n});\nTk.add({\n    image:`images/ear.png`,\n    width:'100px',\n    use:{\n        drag:true,\n        pinch:true,\n        rotate:true,\n        singlePinch:true,\n        singleRotate:true,\n    },\n    limit:true,\n    pos:{\n        x:116,\n        y:45,\n        scale:1.25,\n        rotate:2.63,\n    },\n    close:true,\n});\n\nTk.add({\n    image:`images/neck.png`,\n    width:100,\n    use:{\n        drag:true,\n        pinch:true,\n        rotate:true,\n        singlePinch:true,\n        singleRotate:true,\n    },\n    limit:true,\n    pos:{\n        x:0,\n        y:0,\n        scale:1,\n        rotate:0,\n    },\n    close:true,\n});\n// Tk.freeze(true);\n\n$('.js-btn').on('click',function(){\n    Tk.exportImage(b64=>{\n        $('.js-result').attr('src',b64);\n    });\n});\n$('.Button').on('touchstart',function(){\n    $(this).addClass('taped');\n});\n$('.Button').on('touchend',function(){\n    $(this).removeClass('taped');\n});\n"],"names":["v1","error","Math","sqrt","x","y","v2","direction","getLength","len2","mr","len1","dot","r","acos","PI","el","offset","getOffset","left","getBoundingClientRect","width","top","round","obj1","obj2","k","hasOwnProperty","_typeof","Node","extend","p1","p2","ev","index","touches","pageX","pageY","document","querySelector","rect","body","scrollLeft","scrollTop","offsetWidth","offsetHeight","matrix","arr","replace","split","cos","sin","tan","rotate","atan","scale","trans","parseInt","evName","useName","end","indexOf","DOMString","htmlDoc","implementation","createHTMLDocument","innerHTML","children","_el","key","getEl","getAttribute","str1","str2","defaulTrans","style","window","getComputedStyle","cssTrans","transform","webkitTransform","matrixTo","JSON","parse","HandlerBus","handlers","handler","push","forEach","value","splice","length","apply","_this2","EVENT","ORIGINEVENT","MTouch","use","operator","_","draging","pinching","rotating","singlePinching","singleRotating","fingers","startScale","startPoint","secondPoint","pinchStartLength","singlePinchStartLength","vector1","singleBasePoint","_driveBus","_bind","prototype","_this","fn","bind","addEventListener","destroy","removeEventListener","_this3","_start","e","type","getPoint","getBasePoint","getVector","singlePinch","pinchV1","touchstart","fire","origin","eventType","_move","isSingleButton","data","target","curFingers","curPoint","singlePinchLength","pinchLength","rotateV1","rotateV2","pinchV2","curSecPoint","vector2","pinch","_eventFire","getAngle","singleRotate","drag","touchmove","preventDefault","_end","_eventEnd","touchend","ing","start","_addButton","domify","button","_style","appendChild","setAttribute","position","switch","addButton","on","include","_on","v","getUseName","add","off","del","image","loaded","img","Image","crossOrigin","onload","onerror","src","Object","toString","call","cbk","loadImage","log","err","obj","MCanvas","cwidth","cheight","ops","canvas","ctx","queue","textData","bgConfig","_init","createElement","height","getContext","background","bg","color","fillStyle","fillRect","getImage","_background","iRatio","naturalWidth","naturalHeight","cRatio","sx","sy","swidth","sheight","dx","dy","dwidth","dheight","drawImage","_next","watermark","pos","margin","options","def","isArr","_add","_handleOps","ratio","cdx","cdy","cdw","cdh","crop","lsx","lsy","lsw","lsh","ldx","ldy","ldw","ldh","rw","rh","rspaceX","rspaceY","lcvs","lctx","translate","cw","ch","iw","ih","_get","maxLsw","maxLsh","cropx","cropy","cropw","croph","px","py","pr","ps","parseFloat","text","context","fontFamily","size","option","_text","_parse","result","i","test","splitTag","tmp","textArr","line","lineheight","getLineHeight","font","_this4","measureText","fontLength","forin","lineWidth","align","_fillText","lh","vlh","textAlign","textBaseline","fillText","par","child","str","draw","b64","_this5","toDataURL","shift","sheet","stringify","cls","_cls","trim","className","RegExp","_par","substring","delegateTarget","id","tagName","toLowerCase","parentNode","selector","rules","createStyleSheet","insertRule","parentElement","removeChild","success","head","ZIndex","config","topIndex","min","zIndexArr","max","resetIndex","zIndex","removeIndex","setIndex","requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","callback","setTimeout","Touchkit","_ops","event","elStatus","clientWidth","clientHeight","operatorStatus","freezed","_childs","_childIndex","_zIndexBox","mt","MT","insertCss","addCssRule","iratio","pw","ph","pratio","minX","minY","addClass","limit","_templateEl","_ele","originWidth","originHeight","spaceX","spaceY","close","_closeBtnEl","setTransform","isAdd","hasClass","delegate","_getOperatorOps","toTop","_child","remove","getPos","delta","deltaX","deltaY","defaulLimit","_limit","limitOperator","singlePinchBtn","singleRotateBtn","closeBtn","setPos","minScale","maxScale","boundaryX","boundaryY","maxX","maxY","removeClass","_tar","freeze","boolean","destory","mtouch","drection","exportImage","mc","MC","addChilds","_image","childPos","bgLeft","bgTop","bgPos","w","$","css","Tk","attr"],"mappings":"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"}