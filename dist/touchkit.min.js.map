{"version":3,"file":"touchkit.min.js","sources":["../node_modules/mtouch/src/utils.js","../node_modules/mtouch/src/index.js","../node_modules/mcanvas/src/index.js","../src/utils.js","../src/index.js","../node_modules/mtouch/src/handlerBus.js","../node_modules/mcanvas/src/utils.js","../src/removeBtn.js","../src/zIndex.js"],"sourcesContent":["let sheet;\nexport default {\n    getLength(v1) {\n        if (typeof v1 !== 'object') {\n            console.error('getLength error!');\n            return;\n        }\n        return Math.sqrt(v1.x * v1.x + v1.y * v1.y);\n    },\n    getAngle(v1, v2) {\n        if (typeof v1 !== 'object' || typeof v2 !== 'object') {\n            console.error('getAngle error!');\n            return;\n        }\n        // 判断方向，顺时针为 1 ,逆时针为 -1；\n        let direction = v1.x * v2.y - v2.x * v1.y > 0 ? 1: -1,\n            // 两个向量的模；\n            len1 = this.getLength(v1),\n            len2 = this.getLength(v2),\n            mr = len1 * len2,\n            dot,r;\n        if (mr === 0)return 0;\n        // 通过数量积公式可以推导出：\n        // cos = (x1 * x2 + y1 * y2)/(|a| * |b|);\n        dot = v1.x * v2.x + v1.y * v2.y;\n        r = dot / mr;\n        if (r > 1)r = 1;\n        if (r < -1)r = -1;\n        // 解值并结合方向转化为角度值；\n        return Math.acos(r) * direction * 180 / Math.PI;\n    },\n    getBasePoint(el) {\n        if (!el) return {x:0,y:0};\n        let offset = this.getOffset(el);\n        let x = offset.left + el.getBoundingClientRect().width / 2,\n            y = offset.top + el.getBoundingClientRect().width / 2;\n        return {x: Math.round(x), y: Math.round(y)};\n    },\n    extend(obj1, obj2) {\n        for (let k in obj2) {\n            if (obj2.hasOwnProperty(k)) {\n                if(typeof obj2[k] == 'object' && !(obj2[k] instanceof Node)){\n                    if(typeof obj1[k] !== 'object'){\n                        obj1[k] = {};\n                    }\n                    this.extend(obj1[k],obj2[k]);\n                }else{\n                    obj1[k] = obj2[k];\n                }\n            }\n        }\n        return obj1;\n    },\n    getVector(p1, p2) {\n        if (typeof p1 !== 'object' || typeof p2 !== 'object' ) {\n            console.error('getvector error!');\n            return;\n        }\n        let x = Math.round(p1.x - p2.x),\n            y = Math.round(p1.y - p2.y);\n        return { x, y };\n    },\n    getPoint(ev, index) {\n        if (!ev || !ev.touches[index]) {\n            console.error('getPoint error!');\n            return;\n        }\n        return {\n            x: Math.round(ev.touches[index].pageX),\n            y: Math.round(ev.touches[index].pageY),\n        };\n    },\n    getOffset(el){\n        el = typeof el == 'string'? document.querySelector(el): el;\n        let rect = el.getBoundingClientRect();\n        let offset = {\n            left:rect.left + document.body.scrollLeft,\n            top:rect.top + document.body.scrollTop,\n            width:el.offsetWidth,\n            height:el.offsetHeight,\n        };\n        return offset;\n    },\n    matrixTo(matrix){\n        let arr = (matrix.replace('matrix(','').replace(')','')).split(',');\n        let cos = arr[0],\n            sin = arr[1],\n            tan = sin / cos,\n            rotate = Math.atan( tan ) * 180 / Math.PI,\n            scale = cos / ( Math.cos( Math.PI / 180 * rotate )),\n            trans;\n        trans = {\n            x:parseInt(arr[4]),\n            y:parseInt(arr[5]),\n            scale,\n            rotate,\n        };\n        return trans;\n    },\n    getUseName(evName){\n        let useName = evName.replace('start','');\n        let end = useName.indexOf('rotate') !== -1 ? 'nd' : 'end';\n        useName = useName.replace(end,'');\n        return useName;\n    },\n    domify(DOMString) {\n        let htmlDoc = document.implementation.createHTMLDocument();\n        htmlDoc.body.innerHTML = DOMString;\n        return htmlDoc.body.children;\n    },\n    getEl(el){\n        if(!el){\n            console.error('el error,there must be a el!');\n            return;\n        }\n        let _el;\n        if(typeof el == 'string'){\n            _el = document.querySelector(el);\n        }else if(el instanceof Node){\n            _el = el;\n        }else{\n            console.error('el error,there must be a el!');\n            return;\n        }\n        return _el;\n    },\n    data(el,key){\n        el = this.getEl(el);\n        return el.getAttribute(`data-${key}`);\n    },\n    include(str1,str2){\n        if(str1.indexOf){\n            return str1.indexOf(str2) !== -1;\n        }else{\n            return false;\n        }\n    },\n    getPos(el) {\n        if(!el)return;\n        el = this.getEl(el);\n        let defaulTrans;\n        let style = window.getComputedStyle(el,null);\n        let cssTrans = style.transform || style.webkitTransform;\n\n        if(window.getComputedStyle && cssTrans !== 'none'){\n            defaulTrans = this.matrixTo(cssTrans);\n        }else{\n            defaulTrans = {\n                x: 0,\n                y: 0,\n                scale: 1,\n                rotate: 0,\n            };\n        }\n        return JSON.parse(el.getAttribute('data-mtouch-status')) || defaulTrans;\n    },\n    addCssRule(selector, rules){\n        if(!sheet){\n            sheet = createStyleSheet();\n        }\n        sheet.insertRule(`${selector}{${rules}}`,sheet.rules.length);\n    },\n};\n\nfunction createStyleSheet() {\n    let style = document.createElement('style');\n    style.type = 'text/css';\n    document.head.appendChild(style);\n    return style.sheet;\n}\n","import _ from './utils';\nimport singleBtn from './singleBtn';\nimport HandlerBus from './handlerBus';\n\nconst EVENT = ['touchstart','touchmove','touchend','drag','dragstart','dragend','pinch','pinchstart','pinchend','rotate','rotatestart','rotatend','singlePinchstart','singlePinch','singlePinchend','singleRotate','singleRotatestart','singleRotatend'];\n\nconst ORIGINEVENT = ['touchstart', 'touchmove', 'touchend', 'touchcancel'];\n\nexport default function MTouch(el = '') {\n    // 兼容不使用 new 的方式；\n    if (!(this instanceof MTouch))return new MTouch(el);\n    // 开关；\n    // 初始化时关闭，在调用 on 函数时对应开启；\n    this.use = {\n        drag: false,\n        pinch: false,\n        rotate: false,\n        singlePinch: false,\n        singleRotate: false,\n    };\n    // 获取容器元素；\n    this.operator = this.el = _.getEl(el);\n    // 状态记录；\n    this.draging = this.pinching = this.rotating = this.singlePinching = this.singleRotating = false;\n    // 全局参数记录；\n    this.fingers = 0;\n    this.startScale = 1;\n    this.startPoint = {};\n    this.secondPoint = {};\n    this.pinchStartLength = null;\n    this.singlePinchStartLength = null;\n    this.vector1 = {};\n    this.singleBasePoint = {};\n\n    // 插入css;\n    this._css();\n    // 初始化注册事件队列；\n    this._driveBus();\n    // 监听原生 touch 事件；\n    this._bind();\n}\n\nMTouch.prototype._driveBus = function() {\n    EVENT.forEach(evName => {\n        this[evName] = new HandlerBus(this.el);\n    });\n};\n\nMTouch.prototype._bind = function() {\n    ORIGINEVENT.forEach(evName => {\n        let fn = evName == 'touchcancel'? 'end': evName.replace('touch', '');\n        // 需要存下 bind(this) 后的函数指向，用于 destroy;\n        this[`_${fn}_bind`] = this[`_${fn}`].bind(this);\n        this.el.addEventListener(evName, this[`_${fn}_bind`], false);\n    });\n};\nMTouch.prototype.destroy = function() {\n    ORIGINEVENT.forEach(evName => {\n        let fn = evName == 'touchcancel' ? 'end' : evName.replace('touch', '');\n        this.el.removeEventListener(evName, this[`_${fn}_bind`], false);\n    });\n};\nMTouch.prototype._start = function(e) {\n    if (!e.touches || e.type !== 'touchstart')return;\n    // 记录手指数量；\n    this.fingers = e.touches.length;\n    // 记录第一触控点；\n    this.startPoint = _.getPoint(e, 0);\n    // 计算单指操作时的基础点；\n    this.singleBasePoint = _.getBasePoint(this.operator);\n    // 双指操作时\n    if (this.fingers > 1) {\n        // 第二触控点；\n        this.secondPoint = _.getPoint(e, 1);\n        // 计算双指向量；\n        this.vector1 = _.getVector(this.secondPoint, this.startPoint);\n        // 计算向量模；\n        this.pinchStartLength = _.getLength(this.vector1);\n    } else if (this.use.singlePinch) {\n        // 单指且监听 singlePinch 时，计算向量模；\n        let pinchV1 = _.getVector(this.startPoint, this.singleBasePoint);\n        this.singlePinchStartLength = _.getLength(pinchV1);\n    }\n    // 触发 touchstart 事件；\n    this.touchstart.fire({origin: e, eventType: 'touchstart'});\n};\nMTouch.prototype._move = function(ev) {\n    if (!ev.touches || ev.type !== 'touchmove')return;\n    // 判断触控点是否为 singlebutton 区域；\n    let isSingleButton = _.data(ev.target,'singleButton'),\n        curFingers = ev.touches.length,\n        curPoint = _.getPoint(ev, 0),\n        singlePinchLength,\n        pinchLength,\n        rotateV1,\n        rotateV2,\n        pinchV2;\n    // 当从原先的两指到一指的时候，可能会出现基础手指的变化，导致跳动；\n    // 因此需屏蔽掉一次错误的touchmove事件，待重新设置基础指后，再继续进行；\n    if (curFingers < this.fingers) {\n        this.startPoint = curPoint;\n        this.fingers = curFingers;\n        return;\n    }\n    // 两指先后触摸时，只会触发第一指一次 touchstart，第二指不会再次触发 touchstart；\n    // 因此会出现没有记录第二指状态，需要在touchmove中重新获取参数；\n    if (curFingers > 1 && (!this.secondPoint || !this.vector1 || !this.pinchStartLength)) {\n        this.secondPoint = _.getPoint(ev, 1);\n        this.vector1 = _.getVector(this.secondPoint, this.startPoint);\n        this.pinchStartLength = _.getLength(this.vector1);\n    }\n    // 双指时，需触发 pinch 和 rotate 事件；\n    if (curFingers > 1) {\n        let curSecPoint = _.getPoint(ev, 1),\n            vector2 = _.getVector(curSecPoint, curPoint);\n        // 触发 pinch 事件；\n        if (this.use.pinch) {\n            pinchLength = _.getLength(vector2);\n            this._eventFire('pinch', {\n                delta: {\n                    scale: pinchLength / this.pinchStartLength,\n                },\n                origin: ev,\n            });\n            this.pinchStartLength = pinchLength;\n        }\n        // 触发 rotate 事件；\n        if (this.use.rotate) {\n            this._eventFire('rotate', {\n                delta: {\n                    rotate: _.getAngle(this.vector1, vector2),\n                },\n                origin: ev,\n            });\n            this.vector1 = vector2;\n        }\n    } else {\n        // 触发 singlePinch 事件;\n        if (this.use.singlePinch && isSingleButton) {\n            pinchV2 = _.getVector(curPoint, this.singleBasePoint);\n            singlePinchLength = _.getLength(pinchV2);\n            this._eventFire('singlePinch', {\n                delta: {\n                    scale: singlePinchLength / this.singlePinchStartLength,\n                    deltaX:curPoint.x - this.startPoint.x,\n                    deltaY:curPoint.y - this.startPoint.y,\n                },\n                origin: ev,\n            });\n            this.singlePinchStartLength = singlePinchLength;\n        }\n        // 触发 singleRotate 事件;\n        if (this.use.singleRotate && isSingleButton) {\n            rotateV1 = _.getVector(this.startPoint, this.singleBasePoint);\n            rotateV2 = _.getVector(curPoint, this.singleBasePoint);\n            this._eventFire('singleRotate', {\n                delta: {\n                    rotate: _.getAngle(rotateV1, rotateV2),\n                },\n                origin: ev,\n            });\n        }\n    }\n    // 触发 drag 事件；\n    if (this.use.drag) {\n        if (!isSingleButton) {\n            this._eventFire('drag', {\n                delta: {\n                    deltaX: curPoint.x - this.startPoint.x,\n                    deltaY: curPoint.y - this.startPoint.y,\n                },\n                origin: ev,\n            });\n        }\n    }\n    this.startPoint = curPoint;\n    // 触发 touchmove 事件；\n    this.touchmove.fire({eventType: 'touchmove', origin: ev});\n    ev.preventDefault();\n};\nMTouch.prototype._end = function(ev) {\n    if (!ev.touches && ev.type !== 'touchend' && ev.type !== 'touchcancel')return;\n    // 触发 end 事件；\n    ['pinch', 'drag', 'rotate', 'singleRotate', 'singlePinch'].forEach(evName => {\n        this._eventEnd(evName, {origin: ev});\n    });\n    this.touchend.fire({eventType: 'touchend', origin: ev});\n};\nMTouch.prototype._eventFire = function(evName, ev) {\n    let ing = `${evName}ing`,\n        start = `${evName}start`;\n    if (!this[ing]) {\n        ev.eventType = start;\n        this[start].fire(ev);\n        this[ing] = true;\n    } else {\n        ev.eventType = evName;\n        this[evName].fire(ev);\n    }\n};\nMTouch.prototype._eventEnd = function(evName, ev) {\n    let ing = `${evName}ing`,\n        end;\n    if (evName == 'rotate' || evName == 'singleRotate') {\n        end = `${evName}nd`;\n    } else {\n        end = `${evName}end`;\n    }\n    if (this[ing]) {\n        ev.eventType = end;\n        this[end].fire(ev);\n        this[ing] = false;\n    }\n};\n// 添加 button 区域；\n// 背景样式由业务方定制；\nMTouch.prototype._addButton = function(el){\n    let button = _.domify(`<div class=\"mtouch-singleButton\" data-singleButton='true'></div>`)[0];\n    el.appendChild(button);\n    el.setAttribute('data-mtouch-addButton',true);\n};\n// 切换 operator;\nMTouch.prototype.switch = function(el,addButton = true) {\n    let _el;\n    if(!el){\n        this.operator = this.el;\n        return;\n    }\n    this.operator = _el = _.getEl(el);\n    if(!_.data(_el,'mtouch-addButton') && (this.use.singleRotate || this.use.singlePinch) && addButton){\n        this._addButton(_el);\n    }\n};\nMTouch.prototype.on = function(evName, handler = ()=>{}, operator) {\n    if(_.include(evName,' ')){\n        evName.split(' ').forEach(v=>{\n            this._on(v,handler,operator);\n        });\n    }else{\n        this._on(evName,handler,operator);\n    }\n    return this;\n};\nMTouch.prototype._on = function(evName,handler,operator){\n    this.use[_.getUseName(evName)] = true;\n    this[evName].add(handler);\n    this.switch(operator);\n};\nMTouch.prototype.off = function(evName, handler) {\n    this[evName].del(handler);\n};\n\nMTouch.prototype._css = function(){\n    _.addCssRule('.mtouch-singleButton',`z-index:9999;position:absolute;right:-15px;bottom: -15px;width:30px;height: 30px;background-size: 100% 100%;background-image:url(${singleBtn});`);\n};\n","import _ from './utils';\n\nexport default function MCanvas(cwidth,cheight,background){\n\n    // 兼容不使用 new 的方式；\n    if (!(this instanceof MCanvas))\n        return new MCanvas(cwidth,cheight,background);\n\n    // 配置canvas初始大小；\n    // cwidth：画布宽度，Number,选填，默认为 500;\n    // cheight: 画布高度，Number，选填，默认与宽度一致；\n    this.ops = {\n        width: cwidth || 500,\n        height:cheight || cwidth,\n        background,\n    };\n    // 全局画布；\n    this.canvas = null;\n    this.ctx = null;\n\n    // 绘制函数队列；\n    this.queue = [];\n    // 最后执行的函数；\n    this.end = null;\n\n    // 文字绘制数据；\n    this.textData = {};\n\n    // 背景图数据;\n    this.bgConfig = null;\n\n    // 初始化创建画布；\n    this._init();\n}\n\nMCanvas.prototype._init = function(){\n    this.canvas = document.createElement('canvas');\n    this.canvas.width = this.ops.width;\n    this.canvas.height = this.ops.height;\n    this.ctx = this.canvas.getContext('2d');\n    if(this.ops.background){\n        this.ctx.fillStyle = this.ops.background;\n        this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);\n    }\n};\n\n// --------------------------------------------------------\n// 绘制背景部分；\n// --------------------------------------------------------\n\nMCanvas.prototype.background = function(bg){\n    if(!bg){\n        if(this.bgConfig){\n            bg = this.bgConfig;\n        }else{\n            console.error('mcanvas error : the init background must has the bg option params.');\n            return;\n        }\n    }else{\n        this.bgConfig = bg;\n    }\n    this.queue.push(() => {\n        if(bg.color){\n            this.ctx.fillStyle = bg.color;\n            this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);\n        }\n        if(bg.image){\n            _.getImage(bg.image, img =>{\n                this._background(img,bg);\n            });\n        }else{\n            console.error('mcanvas error : background image error!');\n        }\n    });\n    return this;\n};\n\nMCanvas.prototype._background = function(img,bg){\n\n    let {iw,ih} = this._getSize(img);\n    // 图片与canvas的长宽比；\n    let iRatio = iw / ih;\n    let cRatio = this.canvas.width / this.canvas.height;\n    // 背景绘制参数；\n    let sx,sy,swidth,sheight,dx,dy,dwidth,dheight;\n    switch (bg.type) {\n        // 裁剪模式，固定canvas大小，原图铺满，超出的部分裁剪；\n        case 'crop':\n            sx = bg.left || 0;\n            sy = bg.top || 0;\n            if(iRatio > cRatio){\n                swidth = ih * cRatio;\n                sheight = ih;\n            }else{\n                swidth = iw;\n                sheight = swidth / cRatio;\n            }\n            dy = dx = 0;\n            dheight = this.canvas.height;\n            dwidth = this.canvas.width;\n            break;\n        // 包含模式，固定canvas大小，包含背景图；\n        case 'contain':\n            sy = sx = 0;\n            swidth = iw;\n            sheight = ih;\n            if(iRatio > cRatio){\n                dwidth = this.canvas.width;\n                dheight = dwidth / iRatio;\n                dx = bg.left || 0;\n                dy = (bg.top || bg.top == 0) ? bg.top : (this.canvas.height - dheight)/2;\n            }else{\n                dheight = this.canvas.height;\n                dwidth = dheight * iRatio;\n                dy = bg.top || 0;\n                dx = (bg.left || bg.left == 0) ? bg.left : (this.canvas.width - dwidth)/2;\n            }\n            break;\n        // 原图模式：canvas与原图大小一致，忽略初始化 传入的宽高参数；\n        // 同时，background 传入的 left/top 均被忽略；\n        case 'origin':\n            this.canvas.width = iw;\n            this.canvas.height = ih;\n            sx = sy = 0;\n            swidth = iw;\n            sheight = ih;\n            dx = dy = 0;\n            dwidth = this.canvas.width;\n            dheight = this.canvas.height;\n            break;\n        default:\n            console.error('mcanvas error:background type error!');\n    }\n    this.ctx.drawImage(img,sx,sy,swidth,sheight,dx,dy,dwidth,dheight);\n    this._next();\n};\n// --------------------------------------------------------\n// 绘制图层部分；\n// --------------------------------------------------------\n\n// 绘制水印；基于 add 函数封装；\nMCanvas.prototype.watermark = function(image = '',ops){\n    if(!image){\n        console.error('mcanvas error : there is not image of watermark.');\n        return;\n    }\n    // 参数默认值；\n    let { width = '40%' , pos = 'rightbottom' , margin = 20} = ops;\n    let position = {\n        x:0,\n        y:0,\n        scale:1,\n        rotate:0,\n    };\n    switch (pos) {\n        case 'leftTop':\n            position.x = `left:${margin}`;\n            position.y = `top:${margin}`;\n            break;\n        case 'leftBottom':\n            position.x = `left:${margin}`;\n            position.y = `bottom:${margin}`;\n            break;\n        case 'rightTop':\n            position.x = `right:${margin}`;\n            position.y = `top:${margin}`;\n            break;\n        case 'rightBottom':\n            position.x = `right:${margin}`;\n            position.y = `bottom:${margin}`;\n            break;\n        default:\n    }\n    this.add(image,{\n        width,\n        pos:position,\n    });\n    return this;\n};\n\n// 通用绘制图层函数；\n// 使用方式：\n// 多张图: add([{image:'',options:{}},{image:'',options:{}}]);\n// 单张图: add(image,options);\nMCanvas.prototype.add = function(image = '',options){\n    // 默认参数；\n    let def = {\n        width:'100%',\n        crop:{\n            x:0,\n            y:0,\n            width:'100%',\n            height:'100%',\n        },\n        pos:{\n            x:0,\n            y:0,\n            scale:1,\n            rotate:0,\n        },\n    };\n\n    if(!_.isArr(image))image = [{image,options}];\n\n    image.forEach( v =>{\n        // 将封装好的 add函数 推入队列中待执行；\n        // 参数经过 _handleOps 加工；\n        this.queue.push(() => {\n            _.getImage(v.image, img => {\n                this._add(img,this._handleOps(_.extend(def,v.options),img));\n            });\n        });\n    });\n\n    return this;\n};\n\nMCanvas.prototype._add = function(img,ops){\n    let {iw,ih} = this._getSize(img);\n    let ratio = iw / ih;\n    // 画布canvas参数；\n    let cdx,cdy,cdw,cdh;\n    // 素材canvas参数；\n    let { x:lsx, y:lsy, width:lsw, height:lsh} = ops.crop;\n    let ldx,ldy,ldw,ldh;\n    // 素材canvas的绘制;\n    let lcvs = document.createElement('canvas');\n    let lctx = lcvs.getContext('2d');\n    // 图片宽高比 * 1.4 是一个最安全的宽度，旋转任意角度都不会被裁剪；\n    // 没有旋转却长宽比很高大的图，会导致放大倍数太大，因此甚至了最高倍数为5；\n    // _ratio 为 较大边 / 较小编 的比例；\n    let _ratio = iw > ih ? iw / ih : ih / iw;\n    let lctxScale = _ratio * 1.4 > 5 ? 5 : _ratio * 1.4;\n    let spaceX,spaceY;\n\n    lcvs.width =  iw * lctxScale;\n    lcvs.height = ih * lctxScale;\n\n    // 从素材canvas的中心点开始绘制；\n    ldx = -iw / 2;\n    ldy = -ih / 2;\n    ldw = iw;\n    ldh = ih;\n\n    lctx.translate(lcvs.width/2,lcvs.height/2);\n    lctx.rotate(ops.pos.rotate);\n    lctx.drawImage(img,lsx,lsy,lsw,lsh,ldx,ldy,ldw,ldh);\n    //\n    // lcvs.style = 'width:300px';\n    // document.querySelector('body').appendChild(lcvs);\n\n    // 获取素材最终的宽高;\n    cdw = ops.width * lctxScale;\n    cdh = cdw / ratio;\n\n    spaceX = (lctxScale - 1) * ops.width / 2;\n    spaceY = spaceX / ratio;\n\n    // 获取素材的位置；\n    //    配置的位置 - 缩放的影响 - 绘制成正方形的影响；\n    cdx = ops.pos.x + cdw * ( 1 - ops.pos.scale )/2 - spaceX;\n    cdy = ops.pos.y + cdh * ( 1 - ops.pos.scale )/2 - spaceY;\n\n    cdw *= ops.pos.scale;\n    cdh *= ops.pos.scale;\n\n    this.ctx.drawImage(lcvs,cdx,cdy,cdw,cdh);\n\n    lcvs = lctx = null;\n    this._next();\n};\n\n// 获取宽高，兼容img，canvas\nMCanvas.prototype._getSize = function(img){\n    let iw,\n        ih;\n    if(img.tagName === 'IMG'){\n        iw = img.naturalWidth;\n        ih = img.naturalHeight;\n    }else if(img.tagName === 'CANVAS'){\n        iw = img.width;\n        ih = img.height;\n    }else{\n        iw = img.offsetWidth;\n        ih = img.offsetHeight;\n    }\n    return{iw,ih};\n};\n// 参数加工函数；\nMCanvas.prototype._handleOps = function(ops,img){\n    let cw = this.canvas.width,\n        ch = this.canvas.height;\n    let {iw,ih} = this._getSize(img);\n\n    // 图片宽高比；\n    let ratio = iw / ih;\n\n    // 根据参数计算后的绘制宽度；\n    let width =  this._get(cw,iw,ops.width,'pos');\n\n    // 裁剪的最大宽高；\n    let maxLsw,maxLsh;\n\n    // 裁剪参数；\n    let { x:cropx,y:cropy,width:cropw,height:croph } = ops.crop;\n    let crop = {\n        x: this._get(cw,iw,cropx,'crop'),\n        y: this._get(ch,ih,cropy,'crop'),\n        width:this._get(cw,iw,cropw,'crop'),\n        height:this._get(ch,ih,croph,'crop'),\n    };\n    // 最大值判定；\n    if(crop.x > iw)crop.x = iw;\n    if(crop.y > ih)crop.y = ih;\n    maxLsw = iw - crop.x;\n    maxLsh = ih - crop.y;\n    if(crop.width > maxLsw)crop.width = maxLsw;\n    if(crop.height > maxLsh)crop.height = maxLsh;\n\n    // 位置参数；\n    let { x: px, y: py, rotate: pr, scale: ps } = ops.pos;\n    let pos = {\n        x:this._get(cw,width,px,'pos'),\n        y:this._get(ch,width/ratio,py,'pos'),\n        scale : ps,\n        rotate : parseFloat(pr) * Math.PI / 180,\n    };\n    return {width,crop,pos};\n};\n\n// --------------------------------------------------------\n// 绘制文字部分；\n// --------------------------------------------------------\nMCanvas.prototype.text = function(context = '', ops){\n    // 默认字体；\n    let fontFamily = `helvetica neue,hiragino sans gb,Microsoft YaHei,arial,tahoma,sans-serif`;\n    // 默认的字体大小;\n    let size = this.canvas.width / 20;\n\n    this.queue.push(()=>{\n        let option = {\n            width : 300,\n            align : 'left',\n            smallStyle:{\n                font : `${size * 0.8}px ${fontFamily}`,\n                color:'#000',\n                lineheight:size * 0.9,\n            },\n            normalStyle:{\n                font : `${size }px ${fontFamily}`,\n                color:'#000',\n                lineheight:size*1.1,\n            },\n            largeStyle:{\n                font : `${size * 1.3}px ${fontFamily}`,\n                color:'#000',\n                lineheight:size * 1.4,\n            },\n            pos:{\n                x:0,\n                y:0,\n            },\n        };\n        option = _.extend(option,ops);\n\n        // 解析字符串模板后，调用字体绘制函数；\n        this._text(this._parse(context),option);\n        this._next();\n    });\n    return this;\n};\n// 字符串模板解析函数\n// 解析 <s></s> <b></b>\nMCanvas.prototype._parse = function(context){\n    let arr = context.split(/<s>|<b>/);\n    let result = [];\n    for(let i=0;i<arr.length;i++){\n        let value = arr[i];\n        if(/<\\/s>|<\\/b>/.test(value)){\n            let splitTag = /<\\/s>/.test(value) ? '</s>' : '</b>',\n                type     = /<\\/s>/.test(value) ? 'small' : 'large';\n            let tmp = arr[i].split(splitTag);\n            result.push({\n                type:type,\n                text:tmp[0],\n            });\n            tmp[1] && result.push({\n                type:'normal',\n                text:tmp[1],\n            });\n            continue;\n        }\n        arr[i] && result.push({\n            text:arr[i],\n            type:'normal',\n        });\n    }\n    return result;\n};\nMCanvas.prototype._text = function(textArr,option){\n    // 处理宽度参数；\n    option.width = this._get(this.canvas.width,0,option.width,'pos');\n\n    let style,line = 1,length = 0,\n        lineheight = getLineHeight(textArr,option),\n        x = this._get(this.canvas.width,option.width,option.pos.x,'pos'),\n        y = (this._get(this.canvas.height,0,option.pos.y,'pos')) + lineheight;\n\n    // data:字体数据；\n    // lineWidth:行宽；\n    this.textData[line] = {\n        data:[],\n        lineWidth:0,\n    };\n\n    // 生成字体数据；\n    textArr.forEach(v =>{\n        style = option[`${v.type}Style`];\n        this.ctx.font = style.font;\n        let width = this.ctx.measureText(v.text).width;\n\n        // 处理 <br> 换行，先替换成 '|',便于单字绘图时进行判断；\n        let context = v.text.replace(/<br>/g,'|');\n\n        // 先进行多字超出判断，超出宽度后再进行单字超出判断；\n        if((length + width) > option.width || context.indexOf('|') !== -1){\n            for (let i=0,fontLength = context.length; i < fontLength; i++) {\n                let font = context[i];\n                width = this.ctx.measureText(font).width;\n\n                // 当字体的计算宽度 > 设置的宽度 || 内容中包含换行时,进入换行逻辑；\n                if((length + width) > option.width || font == '|'){\n                    length = 0;\n                    x = this._get(this.canvas.width,option.width,option.pos.x,'pos');\n                    y += lineheight;\n                    line += 1;\n                    this.textData[line] = {\n                        data:[],\n                        lineWidth:0,\n                    };\n                    if(font == '|')continue;\n                }\n                this.textData[line]['data'].push({\n                    context:font,x,y,style,width,\n                });\n                length += width;\n                x += width;\n                this.textData[line]['lineWidth'] = length;\n            }\n        }else{\n            this.textData[line]['data'].push({\n                context,x,y,style,width,\n            });\n            length += width;\n            x += width;\n            this.textData[line]['lineWidth'] = length;\n        }\n    });\n\n    // 通过字体数据进行文字的绘制；\n    _.forin(this.textData,(k,v)=>{\n        // \b增加 align 的功能；\n        let add = 0;\n        if(v.lineWidth < option.width){\n            if(option.align == 'center'){\n                add = (option.width - v.lineWidth)/2;\n            }else if (option.align == 'right') {\n                add = option.width - v.lineWidth;\n            }\n        }\n        v.data.forEach(text=>{\n            text.x += add;\n            this._fillText(text);\n        });\n    });\n\n    // 获取行高；\n    function getLineHeight(textArr,option) {\n        let lh = 0,vlh;\n        textArr.forEach( v =>{\n            vlh = option[`${v.type}Style`].lineheight;\n            if(vlh > lh)lh = vlh;\n        });\n        return lh;\n    }\n};\nMCanvas.prototype._fillText = function(text){\n    let {context,x,y,style} = text;\n    this.ctx.font = style.font;\n    this.ctx.textAlign = style.align;\n    this.ctx.textBaseline = 'bottom';\n    this.ctx.fillStyle = style.color;\n    this.ctx.fillText(context,x,y);\n};\n\n// --------------------------------------------------------\n// 业务功能函数部分\n// --------------------------------------------------------\n\n// 参数加工函数；\n// 兼容 5 种 value 值：\n// x:250, x:'250px', x:'100%', x:'left:250',x:'center',\n// width:100,width:'100px',width:'100%'\nMCanvas.prototype._get = function(par,child,str,type){\n    let result = str;\n    if(typeof str === 'string'){\n        if(str.indexOf(':') !== -1 && type == 'pos'){\n            let arr = str.split(':');\n            switch (arr[0]) {\n                case 'left':\n                case 'top':\n                    result = +(arr[1].replace('px',''));\n                    break;\n                case 'right':\n                case 'bottom':\n                    result = par - (+(arr[1].replace('px',''))) - child;\n                    break;\n                default:\n            }\n        }else if (str.indexOf('px') !== -1) {\n            result = (+str.replace('px', ''));\n        } else if (str.indexOf('%') !== -1) {\n            if(type == 'crop'){\n                result = child * (+str.replace('%', '')) / 100;\n            }else{\n                result = par * (+str.replace('%', '')) / 100;\n            }\n        }else if(str == 'center'){\n            result = (par-child)/2;\n        }else{\n            result = +str;\n        }\n    }\n    return result;\n};\n\n// 绘制函数；\nMCanvas.prototype.draw = function(fn = ()=>{}){\n    let b64;\n    this.end = () => {\n        setTimeout(()=>{\n            b64 = this.canvas.toDataURL('image/png');\n            fn(b64);\n        },0);\n    };\n    this._next();\n    return this;\n};\nMCanvas.prototype._next = function(){\n    if(this.queue.length > 0){\n        this.queue.shift()();\n    }else{\n        this.end();\n    }\n};\n","let sheet;\nexport default {\n    setPos(el, transform) {\n        let str = JSON.stringify(transform);\n        let value = `translate3d(${transform.x}px,${transform.y}px,0px) scale(${transform.scale}) rotate(${transform.rotate}deg)`;\n        el = this.getEl(el);\n        this.setStyle(el,{\n            transform : value,\n            webkitTransform : value,\n        });\n        el.setAttribute('data-mtouch-status', str);\n    },\n    getPos(el) {\n        if(!el)return;\n        let defaulTrans;\n        let style = window.getComputedStyle(el,null);\n        let cssTrans = style.transform || style.webkitTransform;\n\n        if(window.getComputedStyle && cssTrans !== 'none'){\n            defaulTrans = this.matrixTo(cssTrans);\n        }else{\n            defaulTrans = {\n                x: 0,\n                y: 0,\n                scale: 1,\n                rotate: 0,\n            };\n        }\n        return JSON.parse(el.getAttribute('data-mtouch-status')) || defaulTrans;\n    },\n    extend(obj1, obj2) {\n        for (let k in obj2) {\n            if (obj2.hasOwnProperty(k)) {\n                if(typeof obj2[k] == 'object' && !(obj2[k] instanceof Node)){\n                    if(typeof obj1[k] !== 'object' || obj1[k] === null){\n                        obj1[k] = {};\n                    }\n                    this.extend(obj1[k],obj2[k]);\n                }else{\n                    obj1[k] = obj2[k];\n                }\n            }\n        }\n        return obj1;\n    },\n    getOffset(el){\n        el = this.getEl(el);\n        let offset = {};\n        offset.width = el.clientWidth || el.offsetWidth;\n        offset.height = el.clientHeight || el.offsetHeight;\n        return offset;\n    },\n    matrixTo(matrix){\n        // 解析 matrix 字符串，分割成数组；\n        let arr = (matrix.replace('matrix(','').replace(')','')).split(',');\n        // 根据不等式计算出 rotate 和 scale；\n        let cos = arr[0],\n            sin = arr[1],\n            tan = sin/cos,\n            rotate = Math.atan(tan)*180/Math.PI,\n            scale = cos/(Math.cos(Math.PI/180*rotate)),\n            trans;\n        // 传入翻译后的各项参数；\n        trans = {\n            x:parseInt(arr[4]),\n            y:parseInt(arr[5]),\n            scale,\n            rotate,\n        };\n        return trans;\n    },\n    domify(DOMString) {\n        let htmlDoc = document.implementation.createHTMLDocument();\n        htmlDoc.body.innerHTML = DOMString;\n        return htmlDoc.body.children;\n    },\n    getEl(el){\n        if(!el){\n            console.error('el error,there must be a el!');\n            return;\n        }\n        let _el;\n        if(typeof el == 'string'){\n            _el = document.querySelector(el);\n        }else if(el instanceof Node){\n            _el = el;\n        }else{\n            console.error('el error,there must be a el!');\n            return;\n        }\n        return _el;\n    },\n    setStyle(el,ops){\n        this.forin(ops,(k,v)=>{\n            el.style[k] = v;\n        });\n    },\n    addClass(el,cls){\n        let _cls;\n        el = this.getEl(el);\n        _cls = this.trim(el.className) || '';\n        if(_cls.indexOf(cls) == -1){\n            if(_cls.length == 0){\n                el.className = cls;\n            }else{\n                el.className = _cls + ` ${cls}`;\n            }\n        }\n        return this;\n    },\n    trim(str){\n        if(typeof str == 'string'){\n            return str.replace(/(^\\s*)|(\\s*$)/g, '');\n        }\n    },\n    removeClass(el,cls){\n        let _cls;\n        el = this.getEl(el);\n        _cls = el.className || '';\n        if(_cls.indexOf(cls) !== -1){\n            el.className = _cls.replace(new RegExp(cls, 'g'),'');\n        }\n    },\n    hasClass(el,cls){\n        el = this.getEl(el);\n        return el.className.indexOf(cls) !== -1;\n    },\n    forin(obj,cbk){\n        for(let k in obj){\n            if(obj.hasOwnProperty(k)){\n                cbk(k,obj[k]);\n            }\n        }\n    },\n    xRatio(pos,ratio){\n        pos.x *= ratio;\n        pos.y *= ratio;\n        return pos;\n    },\n    data(el,key,value){\n        el = this.getEl(el);\n        if(!value){\n            return el.getAttribute(`data-${key}`);\n        }else{\n            el.setAttribute(`data-${key}`,value);\n            return this;\n        }\n    },\n    include(str1,str2){\n        if(str1.indexOf){\n            return str1.indexOf(str2) !== -1;\n        }else{\n            return false;\n        }\n    },\n    delegate(par,evName,child,fn = ()=>{}){\n        let _par = this.getEl(par);\n        _par.addEventListener(evName,ev=>{\n            let target = ev.target;\n            while(target !== _par ){\n                if(child.indexOf('.') == 0){\n                    if(this.include(target.className,child.substring(1))){\n                        ev.delegateTarget = target;\n                        fn.bind(target)(ev);\n                        break;\n                    }\n                }else if(child.indexOf('#') == 0){\n                    if(target.id == child.substring(1)){\n                        ev.delegateTarget = target;\n                        fn.bind(target)(ev);\n                        break;\n                    }\n                }else{\n                    if(target.tagName.toLowerCase() == child){\n                        ev.delegateTarget = target;\n                        fn.bind(target)(ev);\n                        break;\n                    }\n                }\n                target = target.parentNode;\n            }\n        });\n    },\n    addCssRule(selector, rules){\n        if(!sheet){\n            sheet = createStyleSheet();\n        }\n        sheet.insertRule(`${selector}{${rules}}`,sheet.rules.length);\n    },\n    remove(el){\n        let _par = el.parentNode || el.parentElement;\n        _par.removeChild(el);\n    },\n    loadImage(image, success, error) {\n        let img = new Image();\n        let loaded = false;\n        if(image.indexOf('http') == 0){\n            img.crossOrigin = '*';\n        }\n        img.onload = () => {\n            if(!loaded){\n                loaded = true;\n                success(img);\n            }\n        };\n        img.onerror = () => {\n            error('img load error');\n        };\n        img.src = image;\n    },\n    getImage(image,success,error){\n        if(typeof image == 'string'){\n            this.loadImage(image, img => {\n                success(img);\n            },err=>{\n                console.log(err);\n                error(err);\n            });\n        }else if(typeof image == 'object' && image instanceof Node){\n            success(image);\n        }else{\n            console.log('add image error');\n            error('type of image is error!');\n            return;\n        }\n    },\n    isArr(arr) {\n        return Object.prototype.toString.call(arr) === '[object Array]';\n    },\n};\n\nfunction createStyleSheet() {\n    let style = document.createElement('style');\n    style.type = 'text/css';\n    document.head.appendChild(style);\n    return style.sheet;\n}\n","import MT from 'mtouch';\nimport MC from 'mcanvas';\nimport removeBtn from './removeBtn';\nimport ZIndex from './zIndex';\nimport _ from './utils';\n\nconst EVENT = ['touchstart','touchmove','touchend','drag','dragstart','dragend','pinch','pinchstart','pinchend','rotate','rotatestart','rotatend','singlePinchstart','singlePinch','singlePinchend','singleRotate','singleRotatestart','singleRotatend'];\nconst noop = function () {};\n\nwindow.requestAnimFrame = (function() {\n    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || function(callback) {\n        window.setTimeout(callback, 1000 / 60);\n    };\n})();\n\nexport default function Touchkit(ops) {\n    // 兼容不使用 new 的方式；\n    if (!(this instanceof Touchkit))\n        return new Touchkit(ops);\n\n    this._ops = {\n        el: null,\n        use:{\n            drag:false,\n            pinch:false,\n            rotate:false,\n            singlePinch:false,\n            singleRotate:false,\n        },\n        limit:false,\n        // event\n        event: {},\n    };\n\n    EVENT.map(eventName => this._ops.event[eventName] = noop);\n\n    if(typeof ops == 'object'){\n        this._ops = _.extend(this._ops, ops);\n    }else if(typeof ops == 'string'){\n        this._ops.el = ops;\n    }\n\n    // 手势容器；\n    this.el = _.getEl(this._ops.el);\n\n    _.addClass(this.el,'mt-touch-box');\n    // 容器宽高，优先使用clientWidth，避免边框等因素的影响；\n    this.elStatus = {\n        width:this.el.clientWidth || this.el.offsetWidth,\n        height:this.el.clientHeight || this.el.offsetHeight,\n    };\n\n    this._cropBox = false;\n\n    this._insertCss();\n\n    this._init();\n\n    // 初始化mtouch；\n    this.mt = MT(this.el);\n\n    this._bind();\n\n}\n\nTouchkit.prototype._init = function(childs = {}){\n    // 操作元素\n    this.operator = null;\n    this.operatorStatus = null;\n\n    this.transform = null;\n    this.freezed = false;\n    // 子元素仓库，index用于标记子元素；\n    this._childs = childs;\n    this._childIndex = 0;\n    this._activeChild = null;\n    // 管理子元素之间的zindex层级关系；\n    this._zIndexBox = new ZIndex();\n};\n\nTouchkit.prototype.background = function(ops){\n    let _ops = {\n        // 背景图片，type: url/HTMLImageElement/HTMLCanvasElement\n        image:'' ,\n        // 绘制方式: crop / contain\n            // crop : 裁剪模式，背景图自适应铺满画布，多余部分裁剪；\n            // contain : 包含模式, 类似于 background-size:contain; 可通过left/top值进行位置的控制；\n        type:'contain',\n        // 背景图片距离画布左上角的距离，\n        left:0,\n        top:0,\n        // 在type=crop时使用，背景图只需启动拖动操作；\n        use:{},\n        static:false,\n        success(){},\n        error(){},\n    };\n    _ops = _.extend(_ops,ops);\n    _.getImage(_ops.image, img => {\n        // 背景图真实宽高及宽高比；\n        let {iw,ih} = this._getSize(img);\n        let iratio = iw / ih;\n        // 容器宽高及宽高比；\n        let pw = this.elStatus.width,\n            ph = this.elStatus.height,\n            pratio = pw / ph;\n\n        let left,top,width,height;\n        let minX = 0 , minY = 0;\n        let ratio;\n\n        let template = _.domify(`<div class=\"mt-background\" data-mt-index=\"background\" data-mt-bg-type=${_ops.type}><div class=\"mt-prevent\"></div></div>`)[0];\n\n        // 初始化背景图属性；\n        _.addClass(img,'mt-image');\n        template.appendChild(img);\n\n        if(_ops.type == 'contain'){\n            if(iratio > pratio){\n                left = _ops.left || 0;\n                top = _ops.top || (ph - pw/iratio) / 2;\n                width = pw;\n                height = pw / iratio;\n                ratio = iw / width;\n            }else{\n                left = _ops.left || (pw - ph*iratio) / 2;\n                top = _ops.top || 0;\n                width = ph*iratio;\n                height = ph;\n                ratio = ih / height;\n            }\n            if(!ops.static){\n                _ops.use = {\n                    drag:true,\n                    pinch:true,\n                    rotate:true,\n                };\n            }\n        }else if(_ops.type == 'crop'){\n            left = 0;\n            top = 0;\n            if(iratio > pratio){\n                width = ph*iratio;\n                height = ph;\n                minX = (width - pw)/width;\n                ratio = ih / height;\n            }else{\n                width = pw;\n                height = pw/iratio;\n                minY = (height - ph)/height;\n                ratio = iw / width;\n            }\n            _ops.limit = {\n                x:minX,\n                y:minY,\n                maxScale:1,\n                minScale:1,\n            };\n            if(!ops.static){\n                _ops.use = {\n                    drag : true,\n                };\n            }\n        }\n        _.setStyle(template,{\n            width:`${width}px`,\n            height:`${height}px`,\n            transform:`translate(${left}px,${top}px)`,\n            webkitTransform:`translate(${left}px,${top}px)`,\n        });\n\n        _ops.pos = {width,height,left,top};\n\n        this.el.appendChild(template);\n\n        // 记录背景图参数；\n        _ops.ratio = ratio;\n\n        this._childs.background = {\n            el:template,\n            ops: _ops,\n            type:'background',\n        };\n        _ops.success(this);\n    },(err)=>{\n        _ops.error(err);\n    });\n    return this;\n};\n\nTouchkit.prototype.add = function(ops){\n    let _ops = {\n        image:'',\n        width:'',\n        use:{\n            drag:false,\n            pinch:false,\n            rotate:false,\n            singlePinch:false,\n            singleRotate:false,\n        },\n        limit:false,\n        pos:{\n            x:0,\n            y:0,\n            scale:1,\n            rotate:0,\n        },\n        close:false,\n        success(){},\n        error(){},\n    };\n\n    if(!_.isArr(ops))ops = [ops];\n\n    ops.forEach(v=>{\n        _.getImage(v.image,img=>{\n            if(v.use == 'all'){\n                v.use ={\n                    drag:true,\n                    pinch:true,\n                    rotate:true,\n                    singlePinch:true,\n                    singleRotate:true,\n                };\n            }\n            this._add(img,_.extend(_ops,v));\n        },err=>{\n            _ops.error(err);\n        });\n    });\n    return this;\n};\n\nTouchkit.prototype._add = function(img,ops){\n    let {iw,ih} = this._getSize(img);\n    let iratio = iw / ih;\n    let _templateEl = img;\n    let _ele = _.domify(`<div class=\"mt-child\" id=\"mt-child-${this._childIndex}\" data-mt-index=\"${this._childIndex}\"><div class=\"mt-prevent\"></div></div>`)[0];\n    let originWidth = this._get('hor',ops.width),\n        originHeight = originWidth / iratio;\n    let spaceX = (ops.pos.scale - 1) * originWidth/2,\n        spaceY = (ops.pos.scale - 1) * originHeight/2;\n    _.setStyle(_ele,{\n        width:`${originWidth}px`,\n        height:`${originHeight}px`,\n    });\n\n    _.addClass(_templateEl,'mt-image');\n    _ele.appendChild(_templateEl);\n    // 是否添加关闭按钮；\n    if(ops.close || this._ops.close){\n        _ele.appendChild(_.domify(`<div class=\"mt-close-btn\"></div>`)[0]);\n    }\n    this.el.appendChild(_ele);\n\n    ops.pos ={\n        x:this._get('hor',ops.pos.x) + spaceX,\n        y:this._get('ver',ops.pos.y) + spaceY,\n        scale:ops.pos.scale,\n        rotate:ops.pos.rotate,\n    };\n\n    // 记录数据；\n    this._childs[this._childIndex] = {\n        el:_ele,\n        ops: ops,\n        type:'element',\n    };\n    // 根据id进行zIndex的设置；\n    this._zIndexBox.setIndex(`mt-child-${this._childIndex}`);\n\n    // 没有开启单指操作时，不添加单指按钮；\n    let addButton = ((ops.use.singlePinch || this._ops.use.singlePinch) || (ops.use.singleRotate || this._ops.use.singleRotate)) ? true : false;\n    // 切换operator到新添加的元素上；\n    this.switch(_ele,addButton);\n\n    // space 为因为缩放造成的偏移误差；\n    this._setTransform(_ele,ops.pos);\n\n    _.setStyle(_ele,{\n        visibility:'visible',\n    });\n\n    this._childIndex++;\n    ops.success(this);\n};\nTouchkit.prototype.cropBox = function(){\n    let cropBox = _.domify(`<div class=\"mt-crop-box\" data-mt-index=\"cropBox\"><div class=\"mt-close-btn\"></div></div>`)[0];\n    this.el.appendChild(cropBox);\n    this.switch(cropBox);\n    this._cropBox = true;\n    this._childs['cropBox'] = {\n        el:cropBox,\n        type:'cropBox',\n        ops: {\n            width:cropBox.offsetWidth,\n            height:cropBox.offsetHeight,\n            use:{\n                drag:true,\n                pinch:false,\n                rotate:false,\n                singlePinch:true,\n                singleRotate:false,\n            },\n            limit:{\n                x:0,\n                y:0,\n                maxScale:1,\n                minScale:0.2,\n            },\n        },\n    };\n};\n// 使用 mcanvas 合成图片后导出 base64;\nTouchkit.prototype.exportImage = function(cbk,cropOps){\n    let cwidth = this.elStatus.width,\n        cheight = this.elStatus.height;\n    let ratio = 1;\n    let addChilds =[];\n\n    if(this._childs.background){\n        let bg = this._childs.background;\n        ratio = bg.ops.ratio;\n        let image = bg.el.querySelector('.mt-image');\n        let bgPos = _.xRatio(_.getPos(bg.el),ratio);\n        addChilds.push({\n            image:image,\n            options:{\n                width:image.width * ratio,\n                pos:bgPos,\n            },\n        });\n    }\n\n    let mc = new MC(cwidth*ratio,cheight*ratio,'#ffffff');\n\n    this._zIndexBox.zIndexArr.forEach(v=>{\n        let child = document.querySelector('#'+v);\n        let image = child.querySelector('.mt-image');\n        let childPos = _.xRatio(_.getPos(child),ratio);\n        let width = image.clientWidth || image.offsetWidth;\n        addChilds.push({\n            image:image,\n            options:{\n                width: width * ratio,\n                pos:childPos,\n            },\n        });\n    });\n    mc.add(addChilds).draw(b64=>{\n        if(this._cropBox){\n            let cropBoxOps = this._childs.cropBox;\n            let cropBox = cropBoxOps.el;\n            let cropBoxPos = _.getPos(cropBox);\n            let corpBoxMc = new MC(cropBoxOps.ops.width * ratio,cropBoxOps.ops.height * ratio);\n            corpBoxMc.add(mc.canvas,{\n                width:mc.canvas.width,\n                pos:{\n                    x: -cropBoxPos.x * ratio,\n                    y: -cropBoxPos.y * ratio,\n                    scale:1,\n                    rotate:0,\n                },\n            }).draw(b64=>{\n                cbk(b64);\n            });\n        }else if(cropOps){\n            let _default = {\n                x:0,\n                y:0,\n                width:'100%',\n                height:'100%',\n            };\n            cropOps = _.extend(_default,cropOps);\n            cropOps.width = this._get('hor',cropOps.width,(mc.canvas.width-cropOps.x));\n            cropOps.height = this._get('ver',cropOps.height,(mc.canvas.height-cropOps.y));\n            let cropMc = new MC(cropOps.width,cropOps.height);\n            cropMc.add(mc.canvas,{\n                width:mc.canvas.width,\n                pos:{\n                    x: -cropOps.x ,\n                    y: -cropOps.y,\n                    scale:1,\n                    rotate:0,\n                },\n            }).draw(b64=>{\n                cbk(b64);\n            });\n        }else{\n            cbk(b64);\n        }\n    });\n};\n\nTouchkit.prototype._bind = function(){\n    // 绑定所有事件；\n    EVENT.forEach(evName=>{\n        if(!this[evName]){\n            this[evName] = () =>{\n                this._ops.event[evName]();\n            };\n        }\n        this.mt.on(evName,this[evName].bind(this));\n    });\n\n    // 切换子元素；\n    let touchstart;\n    _.delegate(this.el,'touchstart','.mt-background',()=>{\n        touchstart = new Date().getTime();\n    });\n\n    _.delegate(this.el,'touchend','.mt-background',ev=>{\n        if(new Date().getTime() - touchstart > 300 || ev.touches.length)return;\n        this.switch(ev.delegateTarget,false);\n    });\n\n    _.delegate(this.el,'touchend','.mt-crop-box',ev=>{\n        if(ev.touches.length > 0)return;\n        this.switch(ev.delegateTarget);\n    });\n\n    // 点击子元素外的区域失去焦点；\n    this.el.addEventListener('click',ev=>{\n        if(!this._isAdd(ev.target)){\n            this.switch(null);\n        }\n    });\n\n    _.delegate(this.el,'touchstart','.mt-child',()=>{\n        touchstart = new Date().getTime();\n    });\n\n    // 切换子元素；\n    _.delegate(this.el,'touchend','.mt-child',ev=>{\n        if(new Date().getTime() - touchstart > 300 || ev.touches.length > 0)return;\n        let el = ev.delegateTarget,\n            _ops = this._getOperatorOps(el),\n            _addButton = ((_ops.use.singlePinch || this._ops.use.singlePinch) || (_ops.use.singleRotate || this._ops.use.singleRotate)) ? true : false;\n        this.switch(el,_addButton);\n        this._zIndexBox.toTop(el.id);\n    });\n\n    // 关闭按钮事件；\n    _.delegate(this.el,'click','.mt-close-btn',ev=>{\n        let _el = ev.delegateTarget;\n        let _child = _el.parentNode || _el.parentElement;\n        let index = _.data(_child,'mt-index');\n        if(index == 'cropBox'){\n            this.switch(null);\n            this._cropBox = false;\n        }else{\n            this._zIndexBox.removeIndex(_child.id);\n        }\n        _.remove(_child);\n        this._childs[index] = null;\n    });\n};\n\nTouchkit.prototype.touchstart = function(ev){\n    if(!this.freezed){\n        if(this.operator){\n            this.transform = _.getPos(this.operator);\n        }\n        this._ops.event.touchstart(ev);\n    }\n};\n\nTouchkit.prototype.drag = function(ev){\n    if(!this.freezed){\n        if(this.operator){\n            let ops = this._getOperatorOps();\n            if(ops.use.drag || this._ops.use.drag){\n                this.transform.x += ev.delta.deltaX;\n                this.transform.y += ev.delta.deltaY;\n                this._setTransform();\n            }\n        }\n        this._ops.event.drag(ev);\n    }\n};\n\nTouchkit.prototype.pinch = function(ev){\n    if(!this.freezed){\n        if(this.operator){\n            let ops = this._getOperatorOps();\n            if(ops.use.pinch || this._ops.use.pinch){\n                this.transform.scale *= ev.delta.scale;\n                this._setTransform();\n            }\n        }\n        this._ops.event.pinch(ev);\n    }\n};\nTouchkit.prototype.rotate = function(ev){\n    if(!this.freezed){\n        if(this.operator){\n            let ops = this._getOperatorOps();\n            if(ops.use.rotate || this._ops.use.rotate){\n                this.transform.rotate += ev.delta.rotate;\n                this._setTransform();\n            }\n        }\n        this._ops.event.rotate(ev);\n    }\n};\nTouchkit.prototype.singlePinch = function(ev){\n    if(!this.freezed){\n        if(this.operator){\n            let ops = this._getOperatorOps();\n            if(_.data(this.operator,'mt-index') == 'cropBox'){\n                if(ops.use.singlePinch || this._ops.use.singlePinch){\n                    let cropBoxPos = _.getPos(this.operator);\n                    if((ops.width + ev.delta.deltaX + cropBoxPos.x) < this.elStatus.width){\n                        ops.width += ev.delta.deltaX;\n                    }\n                    if((ops.height + ev.delta.deltaY + cropBoxPos.y) < this.elStatus.height){\n                        ops.height += ev.delta.deltaY;\n                    }\n                    _.setStyle(this.operator,{\n                        width:`${ops.width}px`,\n                        height:`${ops.height}px`,\n                    });\n                }\n            }else{\n                if(ops.use.singlePinch || this._ops.use.singlePinch){\n                    this.transform.scale *= ev.delta.scale;\n                    this._setTransform();\n                }\n            }\n        }\n        this._ops.event.singlePinch(ev);\n    }\n};\nTouchkit.prototype.singleRotate = function(ev){\n    if(!this.freezed){\n        if(this.operator){\n            let ops = this._getOperatorOps();\n            if(ops.use.singleRotate || this._ops.use.singleRotate){\n                this.transform.rotate += ev.delta.rotate;\n                this._setTransform();\n            }\n        }\n        this._ops.event.singleRotate(ev);\n    }\n};\nTouchkit.prototype._setTransform = function(el = this.operator, transform = this.transform) {\n    let trans = JSON.parse(JSON.stringify(transform));\n    let ops = this._getOperatorOps();\n\n    let defaulLimit = (this._ops.limit && typeof this._ops.limit == 'object') ? _.extend({\n        x:0.5,\n        y:0.5,\n        maxScale:3,\n        minScale:0.4,\n    },this._ops.limit) : {\n        x:0.5,\n        y:0.5,\n        maxScale:3,\n        minScale:0.4,\n    };\n\n    let _limit = (ops.limit && ops.limit !== true) ? _.extend(defaulLimit,ops.limit) : defaulLimit;\n    if(ops.limit || this._ops.limit){\n        trans = this._limitOperator(trans,_limit);\n    }\n    if(ops.use.singlePinch || this._ops.use.singlePinch){\n        let singlePinchBtn = el.querySelector(`.mtouch-singleButton`);\n        _.setStyle(singlePinchBtn,{\n            transform:`scale(${1/trans.scale})`,\n            webkitTransform:`scale(${1/trans.scale})`,\n        });\n    }\n    if(ops.use.singleRotate || this._ops.use.singleRotate){\n        let singleRotateBtn = el.querySelector(`.mtouch-singleButton`);\n        _.setStyle(singleRotateBtn,{\n            transform:`scale(${1/trans.scale})`,\n            webkitTransform:`scale(${1/trans.scale})`,\n        });\n    }\n    if(ops.close || this._ops.close){\n        let closeBtn = el.querySelector(`.mt-close-btn`);\n        _.setStyle(closeBtn,{\n            transform:`scale(${1/trans.scale})`,\n            webkitTransform:`scale(${1/trans.scale})`,\n        });\n    }\n    window.requestAnimFrame(()=>{\n        _.setPos(el, trans);\n    });\n};\nTouchkit.prototype._limitOperator = function(transform,limit) {\n    // 实时获取操作元素的状态；\n    let {minScale, maxScale} = limit;\n    if (minScale && transform.scale < minScale){\n        transform.scale = minScale;\n    }\n    if (maxScale && transform.scale > maxScale){\n        transform.scale = maxScale;\n    }\n    let operatorStatus = _.getOffset(this.operator);\n    // 因缩放产生的间隔；\n    let spaceX = operatorStatus.width * (transform.scale - 1) / 2;\n    let spaceY = operatorStatus.height * (transform.scale - 1) / 2;\n    // 参数设置的边界值；\n    let boundaryX = operatorStatus.width * transform.scale  * (limit.x);\n    let boundaryY = operatorStatus.height * transform.scale * (limit.y);\n    // 4个边界状态；\n    let minX = spaceX - boundaryX;\n    let minY = spaceX - boundaryY;\n    let maxX = this.elStatus.width - operatorStatus.width * transform.scale + spaceX + boundaryX;\n    let maxY = this.elStatus.height - operatorStatus.height * transform.scale + spaceY + boundaryY;\n\n    if(limit.x || limit.x == 0){\n        if(transform.x >= maxX)transform.x = maxX;\n        if(transform.x < minX)transform.x = minX;\n    }\n    if(limit.y || limit.y == 0){\n        if(transform.y > maxY)transform.y = maxY;\n        if(transform.y < minY)transform.y = minY;\n    }\n    return transform;\n};\nTouchkit.prototype.switch = function(el,addButton){\n    if(!this.mt || this.freezed)return;\n    if(el){\n        el = _.getEl(el);\n    }\n    _.forin(this._childs,(k,v)=>{\n        if(v){\n            _.removeClass(v.el,'mt-active');\n        }\n    });\n    // 转换操作元素后，也需要重置 mtouch 中的单指缩放基本点 singleBasePoint;\n    this.mt.switch(el,addButton);\n    // 切换operator;\n    this.operator = el;\n\n    if(el){\n        _.addClass(el,'mt-active');\n        this._activeChild = el;\n    }\n    return this;\n};\n\nTouchkit.prototype._getOperatorOps = function(target){\n    let _tar = target || this.operator;\n    let index = _.data(_tar,'mt-index');\n    if(this._childs[index]){\n        return this._childs[index].ops;\n    }\n};\n\n// 冻结手势容器，暂停所有操作，且失去焦点；\n// 解冻后恢复最后状态；\nTouchkit.prototype.freeze = function(boolean){\n    if(boolean){\n        _.forin(this._childs,(k,v)=>{\n            if(v){\n                _.removeClass(v.el,'mt-active');\n            }\n        });\n    }else{\n        _.addClass(this._activeChild,'mt-active');\n    }\n    this.freezed = boolean ? true:false;\n    return this;\n};\n\nTouchkit.prototype.clear = function(){\n    _.forin(this._childs,(k,v)=>{\n        if(v && v.type == 'element'){\n            _.remove(v.el);\n            this._childs[k] = null;\n        }\n    });\n    this._init(this._childs);\n};\n\n// 重置所有状态到初始化阶段；\nTouchkit.prototype.reset = function(){\n    _.forin(this._childs,(k,v)=>{\n        if(v){\n            _.remove(v.el);\n        }\n    });\n    this._init();\n};\n\n// 销毁，但保持原有样式，失去焦点与事件绑定；\nTouchkit.prototype.destory = function(){\n    _.forin(this._childs,(k,v)=>{\n        if(v){\n            _.removeClass(v.el,'mt-active');\n        }\n    });\n    this.mt && this.mt.destroy();\n    this.mt = null;\n};\n// 参数加工函数；\n// 兼容 5 种 value 值：\n// x:250, x:'250px', x:'100%', x:'left:250',x:'center',\n// width:100,width:'100px',width:'100%'\nTouchkit.prototype._get = function(drection,str,par , child){\n    let result = str;\n    let k,_par,_child;\n    if(document.body && document.body.clientWidth){\n        k = drection == 'hor' ? 'clientWidth':'clientHeight';\n    }else{\n        k = drection == 'hor' ? 'offsetWidth' : 'offsetHeight';\n    }\n    _par = par || this.el[k];\n    _child = child || (this.operator ? this.operator[k] : 0);\n    if(typeof str === 'string'){\n        if(_.include(str,':')){\n            let arr = str.split(':');\n            switch (arr[0]) {\n                case 'left':\n                case 'top':\n                    result = +(arr[1].replace('px',''));\n                    break;\n                case 'right':\n                case 'bottom':\n                    result = _par - (+(arr[1].replace('px',''))) - _child;\n                    break;\n                default:\n            }\n        }else if (_.include(str,'px')) {\n            result = (+str.replace('px', ''));\n        } else if (_.include(str,'%')) {\n            result = _par * (+str.replace('%', '')) / 100;\n        }else if(str == 'center'){\n            result = (_par-_child)/2;\n        }else{\n            result = +str;\n        }\n    }\n    return result;\n};\n\nTouchkit.prototype.getChild = function(index){\n    return this._childs[index] || null;\n};\n\nTouchkit.prototype._isAdd = function(el){\n    let target = el;\n    while(target !== this.el || target.tagName.toLowerCase() == 'body'){\n        if(_.include(target.className,'mt-child') || _.include(target.className,'mt-background') || _.include(target.className,'mt-crop-box')){\n            return true;\n        }\n        target = target.parentNode;\n    }\n    return false;\n};\n\nTouchkit.prototype._getSize = function(img){\n    let iw,ih;\n    if(img.tagName === 'IMG'){\n        iw = img.naturalWidth;\n        ih = img.naturalHeight;\n    }else if(img.tagName === 'CANVAS'){\n        iw = img.width;\n        ih = img.height;\n    }else{\n        iw = img.offsetWidth;\n        ih = img.offsetHeight;\n    }\n    return{iw,ih};\n};\n\nTouchkit.prototype._insertCss = function(){\n    _.addCssRule('.mt-touch-box','-webkit-user-select: none;');\n    _.addCssRule('.mtouch-singleButton','display: none;');\n    _.addCssRule('.mt-child.mt-active','z-index: 99;outline:2px solid hsla(0,0%,100%,.5);');\n    _.addCssRule('.mt-active .mtouch-singleButton,.mt-active .mt-close-btn','display: inline-block;');\n    _.addCssRule('.mt-child','position:absolute;text-align:left;visibility:hidden;');\n    _.addCssRule('.mt-image','width:100%;height:100%;position:absolute;left:0;top:0;text-align:left;');\n    _.addCssRule('.mt-close-btn',`z-index:999;position:absolute;width:30px;height:30px;top:-15px;right:-15px;background-size:100%;display:none;background-image:url(${removeBtn})`);\n    _.addCssRule('.mt-background','position:absolute;left:0;top:0;');\n    _.addCssRule('.mt-crop-box','position:absolute;left:5px;top:5px;width:90%;height:90%;border:2px dashed #996699;box-sizing:border-box;z-index:20;');\n    _.addCssRule('.mt-prevent','width:100%;height:100%;position:absolute;left:0;top:0;z-index:99;');\n};\n","export default class HandlerBus{\n    constructor(el) {\n        this.handlers = [];\n        this.el = el;\n    }\n    add(handler){\n        this.handlers.push(handler);\n        return this;\n    }\n    del(handler){\n        if(!handler){\n            this.handlers = [];\n        }else{\n            this.handlers.forEach((value,index)=>{\n                if(value === handler){\n                    this.handlers.splice(index,1);\n                }\n            });\n        }\n        return this;\n    }\n    fire(){\n        if(!this.handlers || !this.handlers.length === 0)return;\n        this.handlers.forEach(handler=>{\n            if(typeof handler === 'function') handler.apply(this.el, arguments);\n        });\n        return this;\n    }\n}\n","export default {\n    extend(obj1, obj2) {\n        for (let k in obj2) {\n            if (obj2.hasOwnProperty(k)) {\n                if (typeof obj2[k] == 'object') {\n                    if (typeof obj1[k] !== 'object' || obj1[k] === null) {\n                        obj1[k] = {};\n                    }\n                    this.extend(obj1[k], obj2[k]);\n                } else {\n                    obj1[k] = obj2[k];\n                }\n            }\n        }\n        return obj1;\n    },\n    loadImage(image, loaded, error) {\n        let img = new Image();\n        if(image.indexOf('http') == 0){\n            img.crossOrigin = '*';\n        }\n        img.onload = () => {\n            loaded(img);\n        };\n        img.onerror = () => {\n            error('img load error');\n        };\n        img.src = image;\n    },\n    isArr(arr) {\n        return Object.prototype.toString.call(arr) === '[object Array]';\n    },\n    getImage(image,cbk){\n        if(typeof image == 'string'){\n                this.loadImage(image, img => {\n                    cbk(img);\n                },err=>{\n                    console.log(err);\n                });\n        }else if(typeof image == 'object'){\n            cbk(image);\n        }else{\n            console.log('add image error');\n            return;\n        }\n    },\n    forin(obj,cbk){\n        for(let k in obj){\n            if(obj.hasOwnProperty(k)){\n                cbk(k,obj[k]);\n            }\n        }\n    },\n};\n","let base64 = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABEBJREFUeNrsm01IVFEUx9+MpVMzgVrhLoqshdWMTq1GXbQpo1Vf0GChs6gk+sCFzUYwZMQaUTEQwYIQQ4Q+pEUfth5caCaYtCjLaJVkmajTSMh0DnMHJJ/v49x3573ROfAHec579/zmzpyPe+/Y4vG4tJHMLm0wywBngNeZbZK7WFZWtm4AI5GIOrCBtgPkAx0GFYJ2gbaDtrL/R0E/Qd9Ak6BR0BBoJqUzzGl5oHOgUyA3yKbw2mxQLmgv6CjoEgjz5DhoAPQYNGtV4AJQDejiihmkGL5BHqYgqB90DzRtlaCFb9pV/LqArnDC/m9bQAH2bBxjs9nAe0AvQfUgp8BY4GRj4Fj7zQI+DnoNOpjCoHsA9AJUkWrgC6AHoG0mZBqc7fvMh5QAV4HCoCwT02sW86FKNPAxUMhCdUWI+SQEeB+o0+SZlZvpTuabocCYDroER2Ke73SX1pSlFRgroCILl8xFzEdDgLGCqk2DPqGW+coNfMOiH2W5j/ZNXuB8kD+NusHzzGcy8BmQQ++ogUDANTg4WNDc3JzncDhsWu/D14bD4Ty8t7q62kUAdjCfuYB1W2VlpcvpdNrLy8sdLS0tmqDxNa2trfk+n8+B9/r9fhdxlk9TgbF5P0QZcXh4eCn5d0lJSY4adBLW4/FkJ6+NjIzEiMBupeClBFyq0ryvaY2Njb/HxsY0QcvBjo6OLoVCoTmOfrqUAuylRo5YLBavq6ubVYNeCzYYDM7iMziCl4cCXMgTLtWgBcJKbMlIfvrltlrYqiUupu3mzRMIhpAIm7yGb4LdbrcJgkX7KiUWD1etWqoFLW5ba6YFwir6rgTsMmhwWWiBsIq+p3TnAT/GMtdEDPWXArxg1OhyAUpPnibYAgV4xijYtra2VdFYa54m2hwFeMooWLfbvSpAacnTHPaFAjwpChYDlNbihGifKcDvRMHqrcgINk4BxsKDlCqamppy1WDVoBsaGnKJsDhGhAL8A/SeMmJxcXGOnjwrB+31enOIwOjzNDUPP6WM2NvbuxCNRuNQ1sW0FhVJaLwH7+3r65snAg8otlIKtXRyiectZdXDJMMe+gjoV/KCnlpaYjf2p9GaVv9KWGpp2QFaTAPYRearxAuMAaA9DYDbJQ2nBLRW7rg9OWFh2Anmo2QUMHYfeJxh3oKw2CjUKHVI1PYQa+vroGULwaIv15RqZ95++I2UOGthFatnPkmigNF6QLdMnull5kOP7kUI4oCPpMT2pBnfaUw/l5kPUqqA0fAET0WKo/cH0EnQK/IyE6cDU8yBO6ysE1ky3gWdAH3keZARK2iYDvBoIK4Dd0uJA6NG2R/QQymxddKhNfUomZFnLb+DbjP4s1JiFw834/Q28nHW4j0DPVGrjc0EXtlwdDPtZDOP+1R40kbp+PAntsoyxHpxISb6vDQ6/pzJErbhfgJgy/xuKQOcAU5r+yfAAGDyyaocNx08AAAAAElFTkSuQmCC`;\n\nexport default base64;\n","// 素材层级管理系统；\nimport _ from './utils';\nexport default class ZIndex {\n    constructor(config) {\n        this.config = {\n            'min': 50,\n            'max': 100,\n        };\n        this.config = _.extend(this.config, config);\n        this.topIndex = this.config.min;\n        this.zIndexArr = [];\n    }\n    init(){\n        this.zIndexArr = [];\n        this.topIndex = this.config.min;\n    }\n    setIndex(id) {\n        this.zIndexArr.push(id);\n        if (this.topIndex > this.config.max) {\n            this.resetIndex();\n        } else {\n            let el = document.querySelector(`#${id}`);\n            el.style.zIndex = this.topIndex;\n            this.topIndex++;\n        }\n    }\n    removeIndex(id) {\n        this.zIndexArr.forEach((value, index, arr) => {\n            if (value == id) {\n                arr.splice(index, 1);\n            }\n        });\n    }\n    resetIndex() {\n        this.zIndexArr.forEach((id, index) => {\n            let el = document.querySelector(`#${id}`);\n            el.style.zIndex = this.config.min+index;\n        });\n        this.topIndex = this.zIndexArr.length + this.config.min;\n    }\n    toTop(id) {\n        if (id !== this.zIndexArr[this.zIndexArr.length - 1]) {\n            this.removeIndex(id);\n            this.setIndex(id);\n        }\n    }\n}\n"],"names":["createStyleSheet","style","document","createElement","type","head","appendChild","sheet","MTouch","el","this","use","operator","_","getEl","draging","pinching","rotating","singlePinching","singleRotating","fingers","startScale","startPoint","secondPoint","pinchStartLength","singlePinchStartLength","vector1","singleBasePoint","_css","_driveBus","_bind","MCanvas","cwidth","cheight","background","ops","canvas","ctx","queue","end","textData","bgConfig","_init","Touchkit","_ops","map","_this","event","eventName","noop","extend","addClass","elStatus","clientWidth","offsetWidth","clientHeight","offsetHeight","_cropBox","_insertCss","mt","MT","v1","error","Math","sqrt","x","y","v2","direction","getLength","len2","mr","len1","dot","r","acos","PI","offset","getOffset","left","getBoundingClientRect","width","top","round","obj1","obj2","k","hasOwnProperty","_typeof","Node","p1","p2","ev","index","touches","pageX","pageY","querySelector","rect","body","scrollLeft","scrollTop","matrix","arr","replace","split","cos","sin","tan","rotate","atan","scale","parseInt","evName","useName","indexOf","DOMString","htmlDoc","implementation","createHTMLDocument","innerHTML","children","_el","key","getAttribute","str1","str2","defaulTrans","window","getComputedStyle","cssTrans","transform","webkitTransform","matrixTo","JSON","parse","selector","rules","insertRule","length","HandlerBus","handlers","handler","push","forEach","value","splice","apply","_this2","EVENT","ORIGINEVENT","prototype","fn","bind","addEventListener","destroy","removeEventListener","_this3","_start","e","getPoint","getBasePoint","getVector","singlePinch","pinchV1","touchstart","fire","origin","eventType","_move","isSingleButton","data","target","curFingers","curPoint","singlePinchLength","pinchLength","rotateV1","rotateV2","pinchV2","curSecPoint","vector2","pinch","_eventFire","getAngle","singleRotate","drag","touchmove","preventDefault","_end","_eventEnd","touchend","ing","start","_addButton","button","domify","setAttribute","switch","addButton","on","include","_on","v","getUseName","add","off","del","addCssRule","image","loaded","img","Image","crossOrigin","onload","onerror","src","Object","toString","call","cbk","loadImage","log","err","obj","height","getContext","fillStyle","fillRect","bg","color","getImage","_background","_getSize","iw","ih","iRatio","cRatio","sx","sy","swidth","sheight","dx","dy","dwidth","dheight","drawImage","_next","watermark","pos","margin","position","options","def","isArr","_add","_handleOps","ratio","cdx","cdy","cdw","cdh","crop","lsx","lsy","lsw","lsh","ldx","ldy","ldw","ldh","lcvs","lctx","_ratio","lctxScale","spaceX","spaceY","translate","tagName","naturalWidth","naturalHeight","cw","ch","_get","maxLsw","maxLsh","cropx","cropy","cropw","croph","px","py","pr","ps","parseFloat","text","context","fontFamily","size","option","_text","_parse","result","i","test","splitTag","tmp","textArr","line","lineheight","lh","vlh","font","_this4","measureText","fontLength","forin","lineWidth","align","_fillText","textAlign","textBaseline","fillText","par","child","str","draw","b64","_this5","toDataURL","shift","stringify","setStyle","cls","_cls","trim","className","RegExp","_par","substring","delegateTarget","id","toLowerCase","parentNode","parentElement","removeChild","success","ZIndex","config","topIndex","min","zIndexArr","max","resetIndex","zIndex","removeIndex","setIndex","requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","callback","setTimeout","childs","operatorStatus","freezed","_childs","_childIndex","_activeChild","_zIndexBox","iratio","pw","ph","pratio","minX","minY","template","static","limit","_templateEl","_ele","originWidth","originHeight","close","_setTransform","cropBox","exportImage","cropOps","addChilds","bgPos","xRatio","getPos","mc","MC","childPos","cropBoxOps","cropBoxPos","_default","cropMc","delegate","Date","getTime","_isAdd","_getOperatorOps","toTop","_child","remove","delta","deltaX","deltaY","trans","defaulLimit","_limit","_limitOperator","singlePinchBtn","singleRotateBtn","closeBtn","setPos","minScale","maxScale","boundaryX","boundaryY","maxX","maxY","removeClass","_tar","freeze","boolean","clear","reset","destory","drection","getChild"],"mappings":"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"}